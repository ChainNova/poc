define(["config","common/module"],function(n,t){var e,r;return r=window,e=[],t.factory("ConstServ",["ajax","$rootScope","$timeout",function(n,t,o){var u,i,a,f,c,s,d,l,g;return u=CORE.api.trade,l="",c=!1,f=function(){var n;if(n=Const.user&&Const.user.enrollId||"",!l&&n&&(l=n),l!==n)return CORE.afterLogout(),!0},s=0,a=function(e){return e||(e=angular.noop),n.get(u+"islogin").success(function(n){var o;return c?location.reload():(Const.loginChecked=1,(o=n.userInfo)?(angular.extend(r.Const.user||(r.Const.user={}),o),e(),1===s&&(t.$emit("reLogined"),t.$$phase||t.$apply()),s=0):e())}).error(function(n){return Const.loginChecked=1,0===s&&(t.$emit("loggedOut"),t.$$phase||t.$apply()),s=1,e(n)})},g=function(){return a(function(n){if(!f()){for(;!n&&e.length;)e.shift()();return o(function(){return setTimeout(g)},1e5)}})},g(),i=function(n,t){var o,u,i,a,f;for(i=n.split("."),f=r.Const,u=0,a=i.length;u<a;u++)if(o=i[u],f=f[o],!f)return e.push(t);return t()},d=function(){return o(function(){return t.viewLoaded=!0})},{await:i,awaitView:function(){return CORE.pathNeedLogin()||d(),t.$on("updateViewLoaded",function(){return d()})}}}])});