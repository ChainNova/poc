define(["common/module","lib/coin","jade!tmpl/bidask","services/fast"],function(n,e,t){return n.directive("ngdBidAsk",["fastServ","pairServ","$timeout",function(n,e,i){return{scope:{widgetType:"@",limit:"@",nofit:"@"},restrict:"A",transclude:!0,template:t,link:function(t,r,o,f){var s,l,u,a,c,d,m;return m=angular.element(window),t.Const=Const,t.offer=d=n.book().offer,t.types=["asks","bids"],t.fast=e.fast,t.limit||(t.limit=20),u=function(){return i(function(){var n,e,i,r;return e=t.offer.asks.length,i=t.offer.bids.length,n=e+i,e>t.limit&&i>t.limit?t.askLen=t.bidLen=t.limit:e===i?(e>t.limit&&(e=t.limit),t.askLen=t.bidLen=e):e>i?(t.bidLen=i,r=2*t.limit-i,e>r&&(e=r),t.askLen=e):i>e?(t.askLen=e,r=2*t.limit-e,i>r&&(i=r),t.bidLen=i):void 0})},a=r.find(".content")[0],l=function(){var n,e,i;return n=r.find(".tbl-head").height(),e=r.find(".fake").height(),i=a.offsetHeight-n,t.widgetType||(i-=e),t.limit=parseInt(i/e/2),u()},c=null,s=function(n){return i.cancel(c),c=i(l,n||50)},t.nofit||(s(),m.on("resize",function(){return s(200)}),t.$watch("Const.user.enrollId",function(){return s()})),t.$watchGroup(["offer.asks.length","offer.bids.length"],function(){return u()}),t.$on("$destroy",function(){return i.cancel(c),m.off("resize",s)})}}}])});