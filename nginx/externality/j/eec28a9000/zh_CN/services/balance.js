define(["common/module","lib/unifyBalance"],function(n,t){var r;return r=CORE.api.trade,n.factory("balanceServ",["ajax","$rootScope","$timeout",function(n,e,u){var o,a,l,c,i,f,s,b,d,m,C;return o=Const.user.balance,s=function(){if(!o)return o=Const.user.balance={ts:null,all:[]}},s(),c=function(n){return s(),o.all.length=0,o.ts=n?null:CORE.ts()},e.$on("after-logout",function(){return c(!0)}),d=null,C=function(){if(d.req)return d.watcher(),d.req.req.command="unsubscribe"},m=null,i=function(n){return u.cancel(m),m=u(f,n||500)},b=function(){if(!d)return d={},e.$watch("Const.user.enrollId",function(n,t){return n?n&&t&&n!==t?(C(),c(!0),void u(function(){return d=null,b()})):f():(t&&C(),void c(!0))})},l=!1,a=null,f=function(){return a&&a.abort(),l=!0,a=n.get(r+"myasset").success(function(n){return l=!1,t.all(o,n),o.ts=CORE.ts(),e.$broadcast("balance-update"),i(5e3)}).error(function(n){return i(5e3)})},{empty:c,all:function(){return b(),o},getBalance:f}}])});