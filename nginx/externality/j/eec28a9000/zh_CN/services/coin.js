define(["common/module","lib/coin","lib/hyper2rp"],function(r,n,e){var t,a,u,i;return u=CORE.api.trade,a="gws.all",i=[Const.Coin.NativeF],t=e.default_gateways(),r.factory("coinServ",["ajax","$rootScope","$timeout",function(r,a,c){var s,o,l,f,p,d,y,g;return s=Const.coins||(Const.coins={ts:null,data:[],all:[],base:[],trade:[]}),g=function(r,n){var e,a;return n&&(s.data.length=0,[].push.apply(s.data,angular.copy(t))),e=[],a=[],r.map(function(r){var n;if(n=r.currency,e.push(n),!s.data.some(function(r){if(r.currency===n)return!0}))return a.push(n),s.data.push(r)}),["all","base","trade"].map(function(r){return n?(s[r].length=0,[].push.apply(s[r],e)):[].push.apply(s[r],a)})},g(t,!0),p=null,d=function(r){return c.cancel(p),p=c(y,r||500)},f=!1,l=null,y=function(){return l&&l.abort(),f=!0,l=r.get(u+"currencys").success(function(r){var n;return f=!1,n=s.data.length,g(e.gateways(r.currencys)),s.ts=CORE.ts(),a.$broadcast("coins-update"),d(3e3)}).error(function(r){return d(1e3)})},y(),o=function(r,e,t){var a,u,i,c;switch(c=r,e?(a=e.issuer,u=e.currency||e.id,i=e.issuer):(u="",i=r),t){case"issuer":case"addr":c=r;break;case"pair":c={name:u,currency:u,issuer:i,precision:n.getPrecision(u)};break;case"all":c=e}return c},{all:function(){return s.all},base:function(){return s.base},trade:function(){return s.trade},getCoins:y,getGatewayByUrl:function(r,n){var e,t,a,u;if(r){for(r=r.toUpperCase(),u=s.data,t=0,a=u.length;t<a;t++)if(e=u[t],r===e.url)return o(e.issuer,e,n);return o(r,null,n)}},getGateway:function(r,n){var e,t,a,u;if(r)for(u=s.data,t=0,a=u.length;t<a;t++)if(e=u[t],e.name===r)return o(r,e,n)},isNative:function(r){return!i.indexOf(r.toUpperCase())}}}])});