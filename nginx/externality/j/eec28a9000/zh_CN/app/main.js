!function(e,n){var t=e.location;e.__=function(e){var n=2<=arguments.length?[].slice.call(arguments,1):[];return n=[].slice.call(arguments,1),e.replace(/%s/g,function(){return n.shift()})};var r=n.documentElement;t.origin||(t.origin=t.protocol+"//"+t.host),"".format||(String.prototype.format=function(){var e=arguments;return this.replace(/\{(\d+)\}/g,function(n,t){return void 0!==e[t]?e[t]:n})});var a=e.CORE||(e.CORE={});a.hosts=[];var s=n.getElementById("jseed")&&n.getElementById("jseed").getAttribute("data-main").match(/^\/j\/.+?\/[_-\w]+?\//);a.jspath=s?s[0]:"/j/",a.api={trade:"/api/",blue:"/api/blue/"},a.title=function(e){var t=" - ",r=n.title.split(t);r[1]||r.push(r[0]),e&&(r[0]=e.replace(/^./,function(e){return e.toUpperCase()})),n.title=e?r.join(t):r[1]},a._createOnceEle=function(e,t){if(e){t||(t="div");var r=n.getElementById(e);return r||(r=n.createElement(t),r.id=e,n.body.appendChild(r)),r}},a._addClass=function(e,n){n=" "+n,e.className=e.className.replace(n,"")+n},a._removeClass=function(e,n){e.className=(" "+e.className+" ").replace(" "+n+" "," ").trim()},a._killEle=function(e){"string"==typeof e&&(e=n.getElementById(e)),a._addClass(e,opt.toggle||"noDis")},a._createEle=function(e,t){t=t||{},t.tag=t.tag||"div";var r=n.getElementById(e);return r?a._removeClass(r,"noDis"):(r=n.createElement(t.tag),n.body.appendChild(r)),e&&(r.id=e),r.className=t.c||"",t.closable?(clearTimeout(r.timer),r.timer=setTimeout(function(){a._addClass(r,"noDis")},1e4),r.onclick=function(){clearTimeout(r.timer),a._addClass(r,"noDis")}):a._removeClass(r,"noDis"),r},a.msg=function(e,n){n||(n="");var t="err"!=n,r=t?"sys-msg2":"sys-msg",s=a._createEle(r,{c:"sys-msg",closable:t,toggle:"off"});return a._addClass(s,n),s.innerHTML=['<p class="cnt">','<a href="javascript:void(0)" class="close" data-dismiss="cnt"></a>',e].join(""),s},a.ts=function(e){return(e?new Date(e):new Date).getTime()},a.tsid=function(e){return(e||"")+a.ts()+Math.round(1e4*Math.random())},a.offset=function(e){var t,r,a={top:0,left:0,width:0,height:0},s=e&&(e.ownerDocument||n);if(s)return t=s.documentElement,"undefined"!=typeof e.getBoundingClientRect&&(a=e.getBoundingClientRect()),r=s.defaultView,{width:a.width||e.offsetWidth,height:a.height||e.offsetHeight,top:a.top+r.pageYOffset-t.clientTop,left:a.left+r.pageXOffset-t.clientLeft}},a.tooltip=function(e,t,r){if(e&&t){r||(r={}),r.placement||(r.placement="top"),void 0==r.autoClose&&(r.autoClose=!0);var s=n.createElement("div");s.className="tooltip "+r.placement+" "+(r.class||"")+" fade in",s.innerHTML='<div class="tooltip-arrow"></div><div class="tooltip-inner">'+t+"</div>",n.body.appendChild(s);var i=a.offset(e),o=document.getElementsByClassName("tooltip")[0];o.style.top=i.top+"px",o.style.left=i.left+"px";var l=o.offsetWidth,c=o.offsetHeight;switch(r.placement){case"right":i.left+=i.width,i.top+=i.height/2-c/2;break;case"bottom":i.left+=i.width/2-l/2,i.top+=i.height;break;case"left":i.left-=l,i.top+=i.height/2-c/2;break;default:i.left+=i.width/2-l/2,i.top-=c}o.style.top=i.top+"px",o.style.left=i.left+"px";var u=function(){n.body.removeChild(s),s=null};return r.autoClose&&setTimeout(u,r.time||500),s}},a.setCookie=function(e,t,r,a,s,i){var o=new Date;o.setTime(o.getTime());var l;!r||r instanceof Date?l=r||o:(r=1e3*r*60*60*24,l=new Date(o.getTime()+r));var c=e+"="+escape(t)+(r?";expires="+l.toGMTString():"")+(a?";path="+a:"")+(s?";domain="+s:"")+(i?";secure":"");n.cookie=c},a.getCookie=function(e){var t=new RegExp("(^| )"+e+"=([^;]*)(;|$)").exec(n.cookie);return t&&t[2]},a.queryFromArray=function(e){return function(n,t){return t instanceof RegExp?e.filter(function(e){return"string"==typeof e?e.match(t):!!e.name&&e.name.match(t)}):e}},a.j2q=function(e){var n=[];for(u in e){var t=e[u];"object"==typeof t&&(t=JSON.stringify(t)),"function"==typeof t&&(t=t.toString()),"undefined"!=typeof t&&n.push(encodeURIComponent(u)+"="+encodeURIComponent(t))}return n.join("&")},a.j2r=function(e){var n=[];return e.map(function(e){"object"==typeof e&&(e=JSON.stringify(e)),"function"==typeof e&&(e=e.toString()),n.push(encodeURIComponent(e))}),n.join("/")},a.pushArray=function(e){if(angular.isArray(e)){var n=e.slice.call(arguments,1);angular.forEach(n,function(n){e.push.apply(e,n)})}},a.getUTCHours=function(e){return(e||new Date).getUTCHours()},a.isApp=function(){return~r.className.indexOf("ua-app")},a.getNgPath=function(){var e=t.pathname.replace(/^\//,"");return e=e||t.hash.replace(/^#!?\//,""),e||"home"},a.getLoginCallbackUrl=function(){return"/passport/?passport=login&c="+encodeURIComponent(t.href)},a.pathNeedLogin=function(){var e=a.getNgPath();return/^(passport|msgs)/.test(e)?0:/^foo/.test(e)?-1:1};var i=n.createElement("a");i.id="fake",n.body.appendChild(i),a.redirect2=function(e,n){i.href=e,1==n&&(i.target="_top"),2==n&&(i.target="_blank"),i.click()},a.redirect2Login=function(e){a.redirect2(a.getLoginCallbackUrl(),e)},a.afterLogout=function(n){for(key in e.Const.user)"balance"!=key&&delete e.Const.user[key];n&&n(),e.angular&&setTimeout(function(){angular.element(r).scope().$emit("after-logout")})};var o=function(e){return{get:function(n){var t=e?e.getItem(n):null;if(!t||"null"===t)return null;try{t=JSON.parse(t)}catch(e){}return t},set:function(n,t){var r=t;if("undefined"==typeof r&&(r=t=null),"string"!=typeof t)try{r=JSON.stringify(t).replace(/,"\$\$hashKey":.*?(,|})/,"$1")}catch(e){}return e.setItem(n,r),t},getSet:function(e,n){var t=this,r=t.get(e);return setTimeout(function(){if(!r){t.set(e,n);try{r=JSON.parse(n)}catch(e){}}}),n},del:function(n){e.removeItem(n)}}};a.SS=o(sessionStorage),a.LS=o(localStorage),a.SLS={get:function(e){return a.SS.get(e)||a.LS.get(e)},set:function(e,n){return a.SS.set(e,n),a.LS.set(e,n),n}};var l={REMOTE_ERROR:"正在连接服务器..."};a.ERR=function(e){return l[e]};var c=a.ERRORCODES={FORBIDDEN:"FORBIDDEN"};for(var u in l)l.hasOwnProperty(u)&&(c[u]=u);a.STATUSES={SUCCESS:"success",FAILED:"failed"}}(window,document),define("common/core",function(){});var slice=[].slice,extend=function(e,n){function t(){this.constructor=e}for(var r in n)hasProp.call(n,r)&&(e[r]=n[r]);return t.prototype=n.prototype,e.prototype=new t,e.__super__=n.prototype,e},hasProp={}.hasOwnProperty;define("lib/BN",["BigNumber"],function(e){var n,t,r,a;return t=function(e){return 0===Number(e)?"0":e.replace(/^([\d,]+\.\d*?)0+$/,"$1").replace(/\.$/,"")},r=function(e){switch(e){case"NaN":case"Infinity":return"";default:return e}},a=function(){var e;return e=1<=arguments.length?slice.call(arguments,0):[],"string"==typeof e[0]&&(e[0]=e[0].replace(/,/g,"")),e},n=function(e){function n(){var e;e=1<=arguments.length?slice.call(arguments,0):[],n.__super__.constructor.call(this,a.apply(null,e))}return extend(n,e),n.prototype.add=function(){var e;return e=1<=arguments.length?slice.call(arguments,0):[],new n(n.__super__.add.call(this,a.apply(null,e)))},n.prototype.sub=function(){var e;return e=1<=arguments.length?slice.call(arguments,0):[],new n(n.__super__.sub.call(this,a.apply(null,e)))},n.prototype.mul=function(){var e;return e=1<=arguments.length?slice.call(arguments,0):[],new n(n.__super__.mul.call(this,a.apply(null,e)))},n.prototype.div=function(){var e;return e=1<=arguments.length?slice.call(arguments,0):[],new n(n.__super__.div.call(this,a.apply(null,e)))},n.prototype.abs=function(){var e;return e=1<=arguments.length?slice.call(arguments,0):[],new n(n.__super__.abs.call(this,a.apply(null,e)))},n.prototype.times=function(){var e;return e=1<=arguments.length?slice.call(arguments,0):[],new n(n.__super__.times.call(this,a.apply(null,e)))},n.prototype.pow=function(){var e;return e=1<=arguments.length?slice.call(arguments,0):[],new n(n.__super__.pow.call(this,a.apply(null,e)))},n.prototype.cmp=function(){var e;return e=1<=arguments.length?slice.call(arguments,0):[],n.__super__.cmp.call(this,a.apply(null,e))},n.prototype.toString=function(e,t){return r(isNaN(e)?n.__super__.toString.call(this,10):this.round(e,t).toString(10))},n.prototype.toNumber=function(e,t){return r(isNaN(e)?n.__super__.toNumber.call(this):Number(this.toString(e,t)))},n.prototype.toFormat=function(){var e,a,s;return e=1<=arguments.length?slice.call(arguments,0):[],a=~e.indexOf("fixed"),a&&e.pop(),s=n.__super__.toFormat.apply(this,e),a||(s=t(s)),r(s)},n.prototype.toPrice=function(){var e,n,t,r;switch(e=1<=arguments.length?slice.call(arguments,0):[],n=this.round().toString(10),n.length){case 1:t=5;break;case 2:t=4;break;case 3:t=3;break;default:t=2}return"0"===n&&(t=6),e.unshift(t),r=this.toFormat.apply(this,e)},n}(e),n.config({ROUNDING_MODE:n.ROUND_DOWN,ERRORS:!1}),window.BN=n}),require.config({baseUrl:"/j/",waitSeconds:15,paths:{config:"common/baseConfig",_:"/j/pub/lodash/3.5.0.min",jquery:"/j/pub/jquery/1.10.2",BigNumber:"/j/pub/bignumber/2.4.0",moment:"/j/pub/moment/2.10.3.locales",mtz:"/j/pub/moment/tz.0.5.10",angular:"/j/pub/angular/1.5.8"},shim:{angular:{exports:"angular",deps:["jquery"]}}}),define("config",["angular","common/core","lib/BN"],function(e){return{load:function(e,n,t,r){n([e],function(e){t(e)})}}}),define("jade",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("jade!tmpl/app/balance",[],function(){return'<div class="bdyC Balance"><div class="brief"><h2>你好 {{Const.user.enrollId}}!</h2><p class="motto"></p></div><ngd-balance></ngd-balance></div>'}),define("jade!tmpl/app/issue",[],function(){return'<div class="bdyC Issue"><ngd-issue-list></ngd-issue-list></div>'}),define("jade!tmpl/app/lite",[],function(){return'<div id="Lite" class="bdyC"><span ngd-pair-switcher="both" ngd-pair-switcher-source="currentSel" class="filter"></span><div class="Trade Cols Cols55"><div class="Col"><div class="offers"><div ngd-bid-ask="ngd-bid-ask" limit="5" nofit="1" class="bidask"></div></div></div><div class="Col"><div ngd-trader2="ngd-trader2" widget-type="lite" ng-if="Const.user.enrollId"></div></div></div><div id="myOrders" ngd-my-orders="ngd-my-orders" widget-type="lite"></div></div>'}),define("jade!tmpl/app/history",[],function(){return"<ngd-history></ngd-history>"}),define("vendor/ngRoute",["angular"],function(e){"use strict";function n(e,n){if(i(e)){n=n||[];for(var t=0,r=e.length;t<r;t++)n[t]=e[t]}else if(o(e)){n=n||{};for(var a in e)"$"===a.charAt(0)&&"$"===a.charAt(1)||(n[a]=e[a])}return n||e}function t(){function t(n,t){return e.extend(Object.create(n),t)}function r(e,n){var t=n.caseInsensitiveMatch,r={originalPath:e,regexp:e},a=r.keys=[];return e=e.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)(\*\?|[\?\*])?/g,function(e,n,t,r){var s="?"===r||"*?"===r?"?":null,i="*"===r||"*?"===r?"*":null;return a.push({name:t,optional:!!s}),n=n||"",""+(s?"":n)+"(?:"+(s?n:"")+(i&&"(.+?)"||"([^/]+)")+(s||"")+")"+(s||"")}).replace(/([\/$\*])/g,"\\$1"),r.regexp=new RegExp("^"+e+"$",t?"i":""),r}i=e.isArray,o=e.isObject;var a={};this.when=function(t,s){var i=n(s);if(e.isUndefined(i.reloadOnSearch)&&(i.reloadOnSearch=!0),e.isUndefined(i.caseInsensitiveMatch)&&(i.caseInsensitiveMatch=this.caseInsensitiveMatch),a[t]=e.extend(i,t&&r(t,i)),t){var o="/"==t[t.length-1]?t.substr(0,t.length-1):t+"/";a[o]=e.extend({redirectTo:t},r(o,i))}return this},this.caseInsensitiveMatch=!1,this.otherwise=function(e){return"string"==typeof e&&(e={redirectTo:e}),this.when(null,e),this},this.$get=["$rootScope","$location","$routeParams","$q","$injector","$templateRequest","$sce",function(n,r,s,i,o,l,u){function d(e,n){var t=n.keys,r={};if(!n.regexp)return null;var a=n.regexp.exec(e);if(!a)return null;for(var s=1,i=a.length;s<i;++s){var o=t[s-1],l=a[s];o&&l&&(r[o.name]=l)}return r}function p(t){var r=w.current;y=v(),b=y&&r&&y.$$route===r.$$route&&e.equals(y.pathParams,r.pathParams)&&!y.reloadOnSearch&&!C,b||!r&&!y||n.$broadcast("$routeChangeStart",y,r).defaultPrevented&&t&&t.preventDefault()}function f(){var t=w.current,a=y;b?(t.params=a.params,e.copy(t.params,s),n.$broadcast("$routeUpdate",t)):(a||t)&&(C=!1,w.current=a,a&&a.redirectTo&&(e.isString(a.redirectTo)?r.path(h(a.redirectTo,a.params)).search(a.params).replace():r.url(a.redirectTo(a.pathParams,r.path(),r.search())).replace()),i.when(a).then(m).then(function(r){a==w.current&&(a&&(a.locals=r,e.copy(a.params,s)),n.$broadcast("$routeChangeSuccess",a,t))},function(e){a==w.current&&n.$broadcast("$routeChangeError",a,t,e)}))}function m(n){if(n){var t=e.extend({},n.resolve);e.forEach(t,function(n,r){t[r]=e.isString(n)?o.get(n):o.invoke(n,null,null,r)});var r=g(n);return e.isDefined(r)&&(t.$template=r),i.all(t)}}function g(n){var t,r;return e.isDefined(t=n.template)?e.isFunction(t)&&(t=t(n.params)):e.isDefined(r=n.templateUrl)&&(e.isFunction(r)&&(r=r(n.params)),e.isDefined(r)&&(n.loadedTemplateUrl=u.valueOf(r),t=l(r))),t}function v(){var n,s;return e.forEach(a,function(a,i){!s&&(n=d(r.path(),a))&&(s=t(a,{params:e.extend({},r.search(),n),pathParams:n}),s.$$route=a)}),s||a[null]&&t(a[null],{params:{},pathParams:{}})}function h(n,t){var r=[];return e.forEach((n||"").split(":"),function(e,n){if(0===n)r.push(e);else{var a=e.match(/(\w+)(?:[?*])?(.*)/),s=a[1];r.push(t[s]),r.push(a[2]||""),delete t[s]}}),r.join("")}var y,b,C=!1,w={routes:a,reload:function(){C=!0;var e={defaultPrevented:!1,preventDefault:function(){this.defaultPrevented=!0,C=!1}};n.$evalAsync(function(){p(e),e.defaultPrevented||f()})},updateParams:function(n){if(!this.current||!this.current.$$route)throw c("norout","Tried updating route when with no current route");n=e.extend({},this.current.params,n),r.path(h(this.current.$$route.originalPath,n)),r.search(n)}};return n.$on("$locationChangeStart",p),n.$on("$locationChangeSuccess",f),w}]}function r(){this.$get=function(){return{}}}function a(n,t,r){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(a,s,i,o,l){function c(){f&&(r.cancel(f),f=null),d&&(d.$destroy(),d=null),p&&(f=r.leave(p),f.then(function(){f=null}),p=null)}function u(){var i=n.current&&n.current.locals,o=i&&i.$template;if(e.isDefined(o)){var u=a.$new(),f=n.current,v=l(u,function(n){r.enter(n,null,p||s).then(function(){!e.isDefined(m)||m&&!a.$eval(m)||t()}),c()});p=v,d=f.scope=u,d.$emit("$viewContentLoaded"),d.$eval(g)}else c()}var d,p,f,m=i.autoscroll,g=i.onload||"";a.$on("$routeChangeSuccess",u),u()}}}function s(e,n,t){return{restrict:"ECA",priority:-400,link:function(r,a){var s=t.current,i=s.locals;a.html(i.$template);var o=e(a.contents());if(s.controller){i.$scope=r;var l=n(s.controller,i);s.controllerAs&&(r[s.controllerAs]=l),a.data("$ngControllerController",l),a.children().data("$ngControllerController",l)}r[s.resolveAs||"$resolve"]=i,o(r)}}}var i,o,l=e.module("ngRoute",["ng"]).provider("$route",t),c=e.$$minErr("ngRoute");l.provider("$routeParams",r),l.directive("ngView",a),l.directive("ngView",s),a.$inject=["$route","$anchorScroll","$animate"],s.$inject=["$compile","$controller","$route"]}),define("vendor/ngPushState",["angular","./ngRoute"],function(e){e.module("ngPushState",[]).run(["$route","$rootScope","$location","$timeout",function(e,n,t,r){t.pushState=function(r,a){var s=e.current,i=s.$$route,o=n.$on("$locationChangeSuccess",function(){var t=e.current,r=t.$$route;r.keys.length&&s&&i.controller==r.controller&&i.templateUrl==r.templateUrl&&(e.current=s,n.$broadcast("$routeUpdate",t)),o()});t.path(r),a||t.replace()}}])}),define("vendor/ngSanitize",["angular"],function(e){"use strict";function n(){function n(e,n){var t,r={},a=e.split(",");for(t=0;t<a.length;t++)r[n?o(a[t]):a[t]]=!0;return r}function t(e,n){null===e||void 0===e?e="":"string"!=typeof e&&(e=""+e),h.innerHTML=e;var t=5;do{if(0===t)throw d("uinput","Failed to sanitize html because the input is unstable");t--,window.document.documentMode&&g(h),e=h.innerHTML,h.innerHTML=e}while(e!==h.innerHTML);for(var r=h.firstChild;r;){switch(r.nodeType){case 1:n.start(r.nodeName.toLowerCase(),p(r.attributes));break;case 3:n.chars(r.textContent)}var a;if(!(a=r.firstChild)&&(1==r.nodeType&&n.end(r.nodeName.toLowerCase()),a=r.nextSibling,!a))for(;null==a&&(r=r.parentNode,r!==h);)a=r.nextSibling,1==r.nodeType&&n.end(r.nodeName.toLowerCase());r=a}for(;r=h.firstChild;)h.removeChild(r)}function p(e){for(var n={},t=0,r=e.length;t<r;t++){var a=e[t];n[a.name]=a.value}return n}function f(e){return e.replace(/&/g,"&amp;").replace(y,function(e){var n=e.charCodeAt(0),t=e.charCodeAt(1);return"&#"+(1024*(n-55296)+(t-56320)+65536)+";"}).replace(b,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function m(e,n){var t=!1,a=r(e,e.push);return{start:function(e,r){e=o(e),!t&&S[e]&&(t=e),t||E[e]!==!0||(a("<"),a(e),s(r,function(t,r){var s=o(r),i="img"===e&&"src"===s||"background"===s;j[s]!==!0||R[s]===!0&&!n(t,i)||(a(" "),a(r),a('="'),a(f(t)),a('"'))}),a(">"))},end:function(e){e=o(e),t||E[e]!==!0||C[e]===!0||(a("</"),a(e),a(">")),e==t&&(t=!1)},chars:function(e){t||a(f(e))}}}function g(e){if(e.nodeType===window.Node.ELEMENT_NODE)for(var n=e.attributes,t=0,r=n.length;t<r;t++){var a=n[t],s=a.name.toLowerCase();"xmlns:ns1"!==s&&0!==s.lastIndexOf("ns1:",0)||(e.removeAttributeNode(a),t--,r--)}var i=e.firstChild;i&&g(i),i=e.nextSibling,i&&g(i)}var v=!1;this.$get=["$$sanitizeUri",function(e){return v&&a(E,O),function(n){var t=[];return c(n,u(t,function(n,t){return!/^unsafe:/.test(e(n,t))})),t.join("")}}],this.enableSvg=function(e){return i(e)?(v=e,this):v},r=e.bind,a=e.extend,s=e.forEach,i=e.isDefined,o=e.lowercase,l=e.noop,c=t,u=m;var h,y=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,b=/([^\#-~ |!])/g,C=n("area,br,col,hr,img,wbr"),w=n("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),$=n("rp,rt"),_=a({},$,w),k=a({},w,n("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,section,table,ul")),x=a({},$,n("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),O=n("circle,defs,desc,ellipse,font-face,font-face-name,font-face-src,g,glyph,hkern,image,linearGradient,line,marker,metadata,missing-glyph,mpath,path,polygon,polyline,radialGradient,rect,stop,svg,switch,text,title,tspan"),S=n("script,style"),E=a({},C,k,x,_),R=n("background,cite,href,longdesc,src,xlink:href"),N=n("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,tabindex,target,title,type,valign,value,vspace,width"),T=n("accent-height,accumulate,additive,alphabetic,arabic-form,ascent,baseProfile,bbox,begin,by,calcMode,cap-height,class,color,color-rendering,content,cx,cy,d,dx,dy,descent,display,dur,end,fill,fill-rule,font-family,font-size,font-stretch,font-style,font-variant,font-weight,from,fx,fy,g1,g2,glyph-name,gradientUnits,hanging,height,horiz-adv-x,horiz-origin-x,ideographic,k,keyPoints,keySplines,keyTimes,lang,marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mathematical,max,min,offset,opacity,orient,origin,overline-position,overline-thickness,panose-1,path,pathLength,points,preserveAspectRatio,r,refX,refY,repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,rotate,rx,ry,slope,stemh,stemv,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,systemLanguage,target,text-anchor,to,transform,type,u1,u2,underline-position,underline-thickness,unicode,unicode-range,units-per-em,values,version,viewBox,visibility,width,widths,x,x-height,x1,x2,xlink:actuate,xlink:arcrole,xlink:role,xlink:show,xlink:title,xlink:type,xml:base,xml:lang,xml:space,xmlns,xmlns:xlink,y,y1,y2,zoomAndPan",!0),j=a({},R,T,N);!function(e){var n;if(!e.document||!e.document.implementation)throw d("noinert","Can't create an inert html document");n=e.document.implementation.createHTMLDocument("inert");var t=n.documentElement||n.getDocumentElement(),r=t.getElementsByTagName("body");if(1===r.length)h=r[0];else{var a=n.createElement("html");h=n.createElement("body"),a.appendChild(h),n.appendChild(a)}}(window)}function t(e){var n=[],t=u(n,l);return t.chars(e),n.join("")}var r,a,s,i,o,l,c,u,d=e.$$minErr("$sanitize");e.module("ngSanitize",[]).provider("$sanitize",n),e.module("ngSanitize").filter("linky",["$sanitize",function(n){var r=/((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"\u201d\u2019]/i,a=/^mailto:/i,s=e.$$minErr("linky"),i=e.isDefined,o=e.isFunction,l=e.isObject,c=e.isString;return function(e,u,d){function p(e){e&&b.push(t(e))}function f(e,n){var t,r=h(e);b.push("<a ");for(t in r)b.push(t+'="'+r[t]+'" ');!i(u)||"target"in r||b.push('target="',u,'" '),b.push('href="',e.replace(/"/g,"&quot;"),'">'),p(n),b.push("</a>")}if(null==e||""===e)return e;if(!c(e))throw s("notstring","Expected string but received: {0}",e);for(var m,g,v,h=o(d)?d:l(d)?function(){return d}:function(){return{}},y=e,b=[];m=y.match(r);)g=m[0],m[2]||m[4]||(g=(m[3]?"http://":"mailto:")+g),v=m.index,p(y.substr(0,v)),f(g,m[0].replace(a,"")),y=y.substring(v+m[0].length);return p(y),n(b.join(""))}}])}),define("vendor/ngMessages",["angular"],function(e){"use strict";function n(){function e(e,n){if(e)return r(e)?e.indexOf(n)>=0:e.hasOwnProperty(n)}return["$animate",function(n){return{restrict:"AE",transclude:"element",priority:1,terminal:!0,require:"^^ngMessages",link:function(t,a,s,i,o){var l,c=a[0],u=s.ngMessage||s.when,d=s.ngMessageExp||s.whenExp,p=function(e){l=e?r(e)?e:e.split(/[\s,]+/):null,i.reRender()};d?(p(t.$eval(d)),t.$watchCollection(d,p)):p(u);var f,m;i.register(c,m={test:function(n){return e(l,n)},attach:function(){f||o(function(e,t){n.enter(e,null,a),f=e;var r=f.$$attachId=i.getAttachId();f.on("$destroy",function(){f&&f.$$attachId===r&&(i.deregister(c),m.detach()),t.$destroy()})})},detach:function(){if(f){var e=f;f=null,n.leave(e)}}})}}}]}var t,r,a,s;e.module("ngMessages",[],function(){t=e.forEach,r=e.isArray,a=e.isString,s=e.element}).directive("ngMessages",["$animate",function(e){function n(e,n){return a(n)&&0===n.length||r(e.$eval(n))}function r(e){return a(e)?e.length:!!e}var s="ng-active",i="ng-inactive";return{require:"ngMessages",restrict:"AE",controller:["$element","$scope","$attrs",function(a,o,l){function c(e,n){for(var t=n,r=[];t&&t!==e;){var a=t.$$ngMessageNode;if(a&&a.length)return h[a];t.childNodes.length&&r.indexOf(t)===-1?(r.push(t),t=t.childNodes[t.childNodes.length-1]):t.previousSibling?t=t.previousSibling:(t=t.parentNode,r.push(t))}}function u(e,n,t){var r=h[t];if(p.head){var a=c(e,n);a?(r.next=a.next,a.next=r):(r.next=p.head,p.head=r)}else p.head=r}function d(e,n,t){var r=h[t],a=c(e,n);a?a.next=r.next:p.head=r.next}var p=this,f=0,m=0;this.getAttachId=function(){return m++};var g,v,h=this.messages={};this.render=function(c){c=c||{},g=!1,v=c;for(var u=n(o,l.ngMessagesMultiple)||n(o,l.multiple),d=[],f={},m=p.head,h=!1,y=0;null!=m;){y++;var b=m.message,C=!1;h||t(c,function(e,n){if(!C&&r(e)&&b.test(n)){if(f[n])return;f[n]=!0,C=!0,b.attach()}}),C?h=!u:d.push(b),m=m.next}t(d,function(e){e.detach()}),d.length!==y?e.setClass(a,s,i):e.setClass(a,i,s)},o.$watchCollection(l.ngMessages||l.for,p.render),a.on("$destroy",function(){t(h,function(e){e.message.detach()})}),this.reRender=function(){g||(g=!0,o.$evalAsync(function(){g&&v&&p.render(v)}))},this.register=function(e,n){var t=f.toString();h[t]={message:n},u(a[0],e,t),e.$$ngMessageNode=t,f++,p.reRender()},this.deregister=function(e){var n=e.$$ngMessageNode;delete e.$$ngMessageNode,d(a[0],e,n),delete h[n],p.reRender()}}]}}]).directive("ngMessagesInclude",["$templateRequest","$document","$compile",function(e,n,t){function r(e,r){var a=t.$$createComment?t.$$createComment("ngMessagesInclude",r):n[0].createComment(" ngMessagesInclude: "+r+" "),i=s(a);e.after(i),e.remove()}return{restrict:"AE",require:"^^ngMessages",link:function(n,s,i){var o=i.ngMessagesInclude||i.src;e(o).then(function(e){n.$$destroyed||(a(e)&&!e.trim()?r(s,o):t(e)(n,function(e){s.after(e),r(s,o)}))})}}}]).directive("ngMessage",n()).directive("ngMessageExp",n())}),define("jade!tmpl/dialog/overlay",[],function(){return'<div ng-class="{in:animate}" ng-style="{\'z-index\':1040+index*10}" ng-click="close($event)" class="overlay"></div>'}),define("jade!tmpl/dialog/window",[],function(){return'<div ng-class="{in:animate}" ng-style="{\'z-index\':1050+index*10}" ng-click="close($event)" ng-transclude="ng-transclude" class="dialog dialogLoading"></div>'}),define("jade!tmpl/dialog/title",[],function(){return'<div ngd-dialog-window="ngd-dialog-window"><div ng-click="$oclose()" title="关闭" class="iF iF-close dialogX"></div><div class="dialogT">提示</div></div>'}),define("lib/dialog",["jade!tmpl/dialog/overlay","jade!tmpl/dialog/window","jade!tmpl/dialog/title","angular"],function(e,n,t){var r=(window,document.documentElement),a=angular.element(r),s=function(e,n){return angular.element(e[0].querySelector(n))};return angular.module("dialog",[]).factory("$$stackedMap",function(){return{createNew:function(){var e=[];return{add:function(n,t){e.push({key:n,value:t})},get:function(n){for(var t=0;t<e.length;t++)if(n==e[t].key)return e[t]},keys:function(){for(var n=[],t=0;t<e.length;t++)n.push(e[t].key);return n},top:function(){return e[e.length-1]},remove:function(n){for(var t=-1,r=0;r<e.length;r++)if(n==e[r].key){t=r;break}return e.splice(t,1)[0]},removeTop:function(){return e.splice(e.length-1,1)[0]},length:function(){return e.length}}}}}).directive("ngdDialogOverlay",["$dialogStack","$timeout",function(n,t){return{restrict:"EA",replace:!0,template:e,link:function(e,r,s){t(function(){e.animate=!0,a.addClass("noScroll")}),e.close=function(e){var t=n.getTop();t&&t.value.overlay&&"static"!=t.value.overlay&&(e.preventDefault(),e.stopPropagation(),t.key&&t.key.dismiss("overlay click"))}}}}]).directive("ngdDialogWindow",["$timeout",function(e){return{restrict:"EA",scope:{index:"@"},replace:!0,transclude:!0,template:n,link:function(n,t,r){n.$on("dataLoaded",function(){if(t.removeClass("pending"),r.insert){var e=s(t,"."+r.insert);e.length&&e.removeClass("pending2")}}),r.insert&&t.removeClass("pending"),e(function(){n.animate=!0})}}}]).factory("$dialogStack",["$document","$compile","$rootScope","$q","$injector","$controller","$templateCache","$http","$timeout","$$stackedMap",function(e,n,r,i,o,l,c,u,d,p){function f(){for(var e=-1,n=$.keys(),t=0;t<n.length;t++)$.get(n[t]).value.overlay&&(e=t);return e}function m(e){var n=$.get(e).value;$.remove(e),n.modalDomEl.remove(),a.removeClass("noScroll"),b&&f()==-1&&(b.remove(),b=void 0),n.modalScope.$destroy()}function g(e){return e.template?i.when(e.template):u.get(e.templateUrl,{cache:c}).then(function(e){return e.data})}function v(e){var n=[];return angular.forEach(e,function(e,t){(angular.isFunction(e)||angular.isArray(e))&&n.push(i.when(o.invoke(e)))}),n}function h(e){e.on("mousedown",k.mousedown)}var y,b,C=r.$new(!0),w=e.find("body").eq(0),$=p.createNew(),_={};r.$watch(f,function(e){C.index=e}),e.on("keydown",function(e){var n,t=angular.isDefined(e.which)?e.which:e.keyCode;if(n=$.top(),27===t&&n&&n.value.keyboard&&r.$apply(function(){n.key&&n.key.dismiss("overlay click")}),n&&8===t){var a=e.target.tagName.toLowerCase();"input"!=a&&"textarea"!=a&&(e.preventDefault(),e.stopPropagation())}});var k={downed:!1,x:null,y:null,target:null,dialog:null,tH:0,bH:0,mousedown:function(n){k.downed=!0,n.preventDefault();var t=k.target=angular.element(n.currentTarget||this),r=k.dialog=t.parent(),a=s(r,".dialogB"),i=s(r,".dialogF");k.tH=t[0].offsetHeight,k.bH=a.length>0?a[0].offsetHeight:i.length>0?i[0].offsetHeight:0,k.x=n.pageX-r[0].offsetLeft,k.y=n.pageY-r[0].offsetTop,t.css({cursor:"move"}),e.on("mousemove",k.mousemove),e.on("mouseup",k.mouseup)},mousemove:function(n){if(k.downed){n.preventDefault();var t=3,r=n.clientX-k.x,a=n.clientY-k.y,s=k.dialog[0].offsetWidth+t,i=k.dialog[0].offsetHeight+t,o=e[0].documentElement.clientWidth,l=e[0].documentElement.clientHeight;r-t<=0&&(r=t),r+s>=o&&(r=o-s),a-t<=t&&(a=t),a+i+k.bH>=l&&(a=l-i-k.bH),k.dialog.css({left:r+"px",top:a+"px",margin:"0 0 0 0"})}},mouseup:function(n){k.downed=!1,k.x=null,k.y=null,k.tH=0,k.bH=0,k.target.css({cursor:""}),n.preventDefault(),e.off("mousemove",k.mousemove),e.off("mouseup",k.mouseup)}};return _.open=function(e,r){var a=r.modalOptions,o=i.all([g(a)].concat(v(a.resolve)));o.then(function(t){var i,o={},c=1;d(function(){r.scope.$broadcast("dataLoaded")},10),a.controller&&(o.$scope=r.scope,o.$dialogInstance=e,o.$element=u,angular.forEach(a.resolve,function(e,n){o[n]=t[c++]}),i=l(a.controller,o));var p=angular.element("<div></div>");p.html(t[0]);var f=n(p)(r.scope);if(u){if(a._insertClass){var m=s(u,"."+a._insertClass);m.length?angular.element(m[0]).append(f.contents()):u.append(f.contents())}else u.append(f.contents());if(a.dragable){var g=s(u,".dialogT");g.length&&h(g)}}},function(n){r.deferred.reject(n),d(function(){e.close()},0);var t=n.data&&n.data.error_text||"载入失败，请稍后再试.";CORE.alert?alert(t):alert(t)}),o.then(function(){r.loadedDeferred.resolve(!0)},function(){r.loadedDeferred.reject(!1)}),$.add(e,{deferred:r.deferred,modalScope:r.scope,overlay:a.overlay,dragable:a.dragable,keyboard:a.keyboard}),f()>=0&&!b&&(y=angular.element("<div ngd-dialog-overlay></div>"),b=n(y)(C),w.append(b)),e.updateTitle=function(e){if(u){var n=s(u,".dialogT");n.length&&n.html(e)}};var c=angular.element(t).addClass(a.classname).attr("index",$.length()-1).attr("insert",a._insertClass||"");a.hideClose&&c.addClass("noClose"),a.title&&s(c,".dialogT").html(a.title);var u=n(c)(r.scope);$.top().value.modalDomEl=u,w.append(u)},_.close=function(e,n){var t=$.get(e);t&&(t.value.deferred.resolve(n),m(e))},_.dismiss=function(e,n){var t=$.get(e).value;t&&(t.deferred.reject(n),m(e))},_.show=function(e){var n=$.get(e);if(!n)return!1;var t=n.value;return t&&t.modalDomEl&&t.modalDomEl.css({opacity:"1"}),!0},_.hide=function(e){var n=$.get(e).value;n&&n.modalDomEl&&n.modalDomEl.css({opacity:"0"})},_.addClass=function(e,n){var t=$.get(e).value;t&&t.modalDomEl&&t.modalDomEl.addClass(n)},_.removeClass=function(e,n){var t=$.get(e).value;t&&t.modalDomEl&&t.modalDomEl.removeClass(n)},_.getTop=function(){return $.top()},_}]).provider("$dialog",function(){var e={options:{overlay:"static",keyboard:!0,dragable:!0,onClose:angular.noop,onConfirm:angular.noop,onDismiss:angular.noop,hideClose:!1},$get:["$rootScope","$q","$dialogStack",function(n,t,r){var a={};return a.open=function(a){var s=t.defer(),i=t.defer(),o={result:s.promise,loaded:i.promise,close:function(e){return r.close(o,e)},dismiss:function(e){!1!==a.onDismiss.call(l,l,o)&&r.dismiss(o,e)},hide:function(){return r.hide(o)},show:function(){return r.show(o)},addClass:function(e){r.addClass(o,e)},removeClass:function(e){r.removeClass(o,e)}};if(a=angular.extend({},e.options,a),a.resolve=a.resolve||{},!a.template&&!a.templateUrl)throw new Error("One of template or templateUrl options is required.");var l=(a.scope||n).$new();return l.$close=o.close,l.$dismiss=o.dismiss,l.$hide=o.hide,l.$show=o.show,l.$addClass=o.addClass,l.$removeClass=o.removeClass,l.$oclose=function(){!1!==a.onClose.call(l,l,o)&&l.$close()},l.$ok=function(){!1!==a.onConfirm.call(l,l,o)&&l.$close()},r.open(o,{scope:l,deferred:s,loadedDeferred:i,modalOptions:a}),o},a}]};return e})});var indexOf=[].indexOf||function(e){for(var n=0,t=this.length;n<t;n++)if(n in this&&this[n]===e)return n;return-1};define("common/locales",["angular"],function(e){var n,t,r,a,s,i,o,l;return s="lang",t=document.documentElement,r=location.hostname.match(/\w+\.\w+$/)[0],CORE.setCookie(s,"",-1,"/"),n="",i=["zh_CN","en_US"],o=[{value:"zh_CN",name:"中文(简体)",iso2Code:"ZH"},{value:"en_US",name:"English",iso2Code:"US"}],l=function(e){if(e!==n)return indexOf.call(i,e)<0&&(e=i[0]),CORE.setCookie(s,e,1e3,"/",r),n=e},a=function(e,n){var t,r,a;if(!n)return e;for(t=0,a=o.length;t<a;t++)if(r=o[t],r.value===e)return r},{localesObj:o,getAll:function(e){return e?o:i},get:function(e){var t,r,o;return n?a(n,e):(r=CORE.getCookie(s),r||(o=navigator,t=o.language||o.useLanguage||o.browserLanguage,
r=/^zh/.test(t)?"zh_CN":i[0]),l(r),a(r,e))},set:l}}),define("jade!tmpl/intercept/unlock",[],function(){return'<div class="dialogC"><form name="former" ng-submit="confirm()" class="form2"><input type="password" autocomplete="off" class="noDis"/><div class="frmCol frmColFull"><p class="frm txt"><input type="password" required="required" novalidate="novalidate" name="pay_pwd" ng-model="unlock.pay_pwd" placeholder="支付密码" class="txt large"/><label title="支付密码"></label></p></div><div ng-if="hasPhonePwd" class="frmCol frmColFull frmCol55"><p class="frm txt"><input type="text" required="required" novalidate="novalidate" name="vcode" ng-model="unlock.password_pay" placeholder="输入短信验证码" class="txt"/><label title="输入短信验证码"></label></p><p class="frm btns2r"><button type="button" ng-click="getVcode()" ng-disabled="!former.vcode || cd&gt;0 || vcodePending" data-ca="unlock-sendvcode" ng-class="{pending: vcodePending}" class="btn btn-vcode btn_minor">发送验证码<q ng-if="cd&gt;0" ng-bind="cd" class="cd"></q></button></p></div><div ng-if="hasGAuth" class="frmCol frmColFull"><p class="frm txt"><input type="text" required="required" novalidate="novalidate" ng-model="unlock.password_pay" placeholder="输入Google验证器动态码" class="txt"/><label title="输入Google验证器动态码"></label></p></div><div ngd-hint="apiErr" ngd-hint-lv="err"></div><div class="frmCol frmColFull"><p class="frm"><button type="submit" ng-disabled="former.$invalid || former.$pending || pending" data-ca="unlock-submit" ng-class="{pending: pending}" class="btn btn1">确认</button></p></div></form></div>'}),define("jade!tmpl/intercept/smsauth",[],function(){return'<div class="dialogC"><p style="margin-bottom:15px" class="alert alert-danger">你的账号状态异常，应该完成{{flagName}}</p><form name="former" ng-submit="confirm()" ng-switch="flag" class="form2"><input type="password" autocomplete="off" class="noDis"/><div ng-switch-when="0" class="frmCol frmColFull"><p class="frm txt"><input type="password" required="required" novalidate="novalidate" name="pay_pwd" ng-model="frm.code" placeholder="支付密码" class="txt large"/><label title="支付密码"></label></p></div><div ng-switch-when="2" class="frmCol frmColFull frmCol55"><p class="frm txt"><input type="text" required="required" novalidate="novalidate" name="vcode" ng-model="frm.code" placeholder="输入短信验证码" class="txt"/><label title="输入短信验证码"></label></p><p class="frm btns2r"><button type="button" ng-click="getVcode()" ng-disabled="!former.vcode || cd&gt;0 || vcodePending" data-ca="unlock-sendvcode" ng-class="{pending: vcodePending}" class="btn btn-vcode btn_minor">发送验证码<q ng-if="cd&gt;0" ng-bind="cd" class="cd"></q></button></p></div><div ng-switch-when="1" class="frmCol frmColFull"><p class="frm txt"><input type="text" required="required" novalidate="novalidate" ng-model="frm.code" placeholder="输入Google验证器动态码" class="txt"/><label title="输入Google验证器动态码"></label></p></div><div ngd-hint="apiErr" ngd-hint-lv="err"></div><div class="frmCol frmColFull"><p class="frm"><button type="submit" ng-disabled="former.$invalid || former.$pending || pending" data-ca="ip-reauth-submit" ng-class="{pending: pending}" class="btn btn1">解锁</button></p></div><p class="fucs2">或&nbsp;<a href="/logout" target="_self" class="fuc">使用其它账号登录</a></p></form></div>'}),define("jade!tmpl/intercept/admin_unlock",[],function(){return'<div class="dialogC"><form name="loginUnlockForm" ng-submit="doUnlock()" class="form2"><div class="frmCol frmColFull"><p class="frm txt"><input type="password" required="required" novalidate="novalidate" name="pwd_pwd" ng-model="unlock.pay_pwd" placeholder="支付密码" class="txt large"/><label title="支付密码"></label></p></div><div ngd-hint="apiErr" ngd-hint-lv="err"></div><div class="frmCol frmColFull"><p class="frm"><button type="submit" ng-disabled="loginUnlockForm.$invalid || loginUnlockForm.$pending || pending" data-ca="login-unlock-submit" ng-class="{pending: pending}" class="btn btn1">解锁</button></p></div></form></div>'}),define("lib/ajax-intercept",["angular","common/locales","jade!tmpl/intercept/unlock","jade!tmpl/intercept/smsauth","jade!tmpl/intercept/admin_unlock"],function(e,n,t,r,a){CORE.api.admin,n.get();e.module("ajaxIntercept",["dialog"]).factory("interceptServ",["$rootScope","$timeout","$interval","$dialog",function(e,n,s,i){var o={unlock:null,reauth:null,frozen:0},l=null,c=function(e,n){o.frozen++,l=CORE.msg(CORE.ERR(CORE.ERRORCODES.REMOTE_ERROR),"err"),setTimeout(function(){o.frozen--,n("retry").success(u).error(u)},5e3)},u=function(){o.frozen>0||!l||(CORE._killEle(l),o.frozen=0)},d=[],p=function(e,n){for(;d.length;)d.shift()(e,n)},f=function(e,n){d.push(n),o.adminunlock&&o.adminunlock.show()||(o.adminunlock=i.open({title:"Admin Unlock",dragable:!1,keyboard:!1,hideClose:!0,classname:"dialog3",template:a,onClose:function(){p(null,"canceled")},controller:["$scope","$timeout","ppServ",function(e,n,t){e.unlock={},e.doUnlock=function(){e.pending=!0,t.unlock(e.unlock.pay_pwd,function(n,t){return e.pending=!1,t?void(e.apiErr=t):(o.adminunlock.close(),p(n))})}}]}))},m=[],g=function(e,n){for(;m.length;)m.shift()(e,n)},v=function(e,n){m.push(n),o.reauth&&o.reauth.show()||(o.reauth=i.open({title:"提示",dragable:!1,keyboard:!1,hideClose:!0,classname:"dialog3",template:r,onClose:function(){g(null,"canceled")},controller:["$scope","$timeout","$interval","accountServ",function(n,t,r,a){n.frm={},n.flag=Number(e.error.dynamic_flag),n.flagName=0==n.flag?"支付密码":"动态验证",n.confirm=function(){n.pending=!0,a.verifySMSCode(n.frm.code,function(e,t){return n.pending=!1,t?n.apiErr=t:(o.reauth.close(),g(e))})},cd=function(e){e?n.cd=e:n.cd--,n.cd&&t(cd,1e3)},n.getVcode=function(){n.vcodePending=!0,delete n.apiErr,a.sendSms("","",function(e,t){if(n.vcodePending=!1,cd(60),t)return n.apiErr=t})}}]}))},h=[],y=function(e,n){for(;h.length;)h.shift()(e,n)},b=function(e,n){var r="ACCOUNT_DYNAMIC_LOCK"==e.error_code?1:0;h.push(n),o.unlock&&o.unlock.show()||(o.unlock=i.open({title:"操作前须解锁.",classname:"dialog3",template:t,onClose:function(){y(null,"canceled")},controller:["$scope","$timeout","$interval","accountServ",function(e,n,t,a){var s=e.hasGAuth=Const.user.hasSetGoogleAuth,i=e.hasPhonePwd=Const.user.hasSetPhonePassword||r;cd=function(t){t?e.cd=t:e.cd--,e.cd&&n(cd,1e3)},e.confirm=function(){_pay_pwd=e.unlock.pay_pwd,_phone_pwd="",(s||i)&&(_pay_pwd=e.unlock.pay_pwd,_phone_pwd=e.unlock.password_pay),e.pending=!0,a.userUnlock(_pay_pwd,_phone_pwd,r,function(n,t){return e.pending=!1,t?e.apiErr=t:(o.unlock.close(),void y(n))})},e.getVcode=function(){e.vcodePending=!0,delete e.apiErr,a.sendSms("","",function(n,t){if(e.vcodePending=!1,cd(60),t)return e.apiErr=t})}}]}))};return{dialog:function(e,n){switch(e.error_code){case"ACCOUNT_LOCK":case"ACCOUNT_DYNAMIC_LOCK":b(e,n);break;case"COOKIE_NOT_UNLOCK":v(e,n);break;case"ADMIN_COOKIE_NOT_UNLOCK":f(e,n);break;case"REMOTE_ERROR":c(e,n)}}}}])}),define("lib/ajax",["angular","lib/ajax-intercept"],function(e){var n=window,t=function(n){var t=n.data;if("object"==typeof t){t||(t={});var r=t.data||t.result||e.copy(t);return r._res=t,t.data=r,delete t.result,n.data=t,t}},r=function(e){var n=e.data,t=n.error_code||n.code,r=n.message||n.mag;return delete e.data,{error:n,error_code:t,error_msg:CORE.ERR(t)||CORE.ERR(r)||r||"未知错误，请稍后重试。"}};return e.module("ajax",["ajaxIntercept"]).config(["$httpProvider",function(e){e.interceptors.push(["$q",function(e){return{request:function(n){return n&&(n.headers||(n.headers={}),n.headers["X-Requested-With"]="XMLHttpRequest"),n||e.when(n)}}}]),e.interceptors.push(["$q",function(e){responseError=function(t,a,s){return a&&(a=r(a),s&&(a._OK=!0),t.data=a),t&&t.data&&"NOT_LOGIN"===t.data.error_code&&(n.Const.loginChecked=1,CORE.afterLogout()),e.reject(t)};var a={response:function(e){var n=t(e);if(n){if("error_code"in n.data||n.status&&n.status!==CORE.STATUSES.SUCCESS)return responseError(e,n,!0);n.status||200!=e.status||(n.status="success"),e.data=n.data,delete n.data}else e._OK=!0;return e},responseError:function(e){return responseError(e,t(e))}};return a}])}]).factory("ajax",["$http","$q","interceptServ",function(n,t,a){function s(n,t){var r,a=[],s=function(e,n){n=null==n?"":n,a[a.length]=encodeURIComponent(e)+"="+encodeURIComponent(n)};if(void 0===t&&(t=!1),e.isArray(n))e.forEach(n,function(e,n){s(e.name,e.value)});else for(r in n)c(r,n[r],t,s);return a.join("&").replace(o,"+")}function i(i){var o=t.defer(),l=t.defer(),c=o.promise;i.headers||(i.headers={}),"content-type"in i.headers||(i.headers["content-type"]="application/x-www-form-urlencoded; charset=UTF-8");var d=i.transformRequest||[];d.unshift(function(n,t){var r=t("content-type");if(e.isObject(n)&&r){if(r.match(/^application\/x-www-form-urlencoded/))return s(n);if(r.match(/^application\/json/))return e.toJson(n)}return n}),i.transformRequest=d,i.xsrfCookieName="_xsrf",c.success=function(e){return c.then(function(n){n&&e(n.data,n.status,n.headers,i)}),c},c.error=function(e){return c.catch(function(n){n&&e(n.data,n.status,n.headers,i)}),c},c.abort=function(e){return l.resolve(e||{}),c},c.setCategory=function(e){var n=u[e];return n||(n=u[e]=[]),i.category=e,n.push(c),c};var p=function(){c.abort=e.noop;var n=u[i.category];n&&(e.each(n,function(e,t){if(e===c)return n.splice(t,1),!1}),n.length||(n=u[i.category]=null))};i.method&&"get"!=i.method.toLowerCase()||(i.url+=(~i.url.indexOf("?")?"&":"?")+"ts="+(new Date).getTime()),i.timeout||(i.timeout=l.promise),i.category&&c.setCategory(i.category),_CORE=CORE,ERRORCODES=_CORE.ERRORCODES;var f=function(e){n(i).then(function(e){p(),o.resolve(e)}).catch(function(e){var n=e.data;if("object"==typeof n){var t=n.error._res;switch(t.status===_CORE.STATUSES.FAILED&&t.nick&&(Const.user||(Const.user={}),Const.user.nick=t.nick),n.error_code){case"REMOTE_ERROR":case"COOKIE_NOT_UNLOCK":case"ADMIN_COOKIE_NOT_UNLOCK":case"ACCOUNT_LOCK":case"ACCOUNT_DYNAMIC_LOCK":return void a.dialog(n,function(n,t,r){return t?(p(),void o.reject(e)):(f(r),c)})}}else e._OK||(e.data=r({data:{status:e.status,_res:{text:e.data},error_code:ERRORCODES.SERVER_ERROR}}));p(),o.reject(e)}).then(function(){e&&e()})};return f(),c}var o=/%20/g,l=/\[\]$/,c=function(n,t,r,a){var s;if(e.isArray(t))e.forEach(t,function(e,t){r||l.test(n)?a(n,e):c(n+"["+("object"==typeof e?t:"")+"]",e,r,a)});else if(!r&&e.isObject(t))for(s in t)c(n+"["+s+"]",t[s],r,a);else a(n,t)},u={};return["get","post","put"].forEach(function(e){i[e]=function(n,t,r){return"get"==e&&(r=t),r||(r={}),r.url=n,r.method=e,"get"!=e&&(r.data=t),i(r)}}),i.abort=function(n){var t=u[n];t&&e.isArray(t)&&(e.forEach(t,function(e){e.abort(),e=null}),t=u[n]=null)},i.param=s,i}])}),define("common/module",["config","vendor/ngSanitize","vendor/ngMessages","lib/dialog","lib/ajax"],function(){var e=window.Const;return e.user||(e.user={}),e.user.balance||(e.user.balance={ts:null,all:[]}),angular.module("CORE",["ngSanitize","ngMessages","ajax","dialog"])}),define("common/Const",["config","common/module"],function(e,n){var t,r;return r=window,t=[],n.factory("ConstServ",["ajax","$rootScope","$timeout",function(e,n,a){var s,i,o,l,c,u,d,p,f;return s=CORE.api.trade,p="",c=!1,l=function(){var e;if(e=Const.user&&Const.user.enrollId||"",!p&&e&&(p=e),p!==e)return CORE.afterLogout(),!0},u=0,o=function(t){return t||(t=angular.noop),e.get(s+"islogin").success(function(e){var a;return c?location.reload():(Const.loginChecked=1,(a=e.userInfo)?(angular.extend(r.Const.user||(r.Const.user={}),a),t(),1===u&&(n.$emit("reLogined"),n.$$phase||n.$apply()),u=0):t())}).error(function(e){return Const.loginChecked=1,0===u&&(n.$emit("loggedOut"),n.$$phase||n.$apply()),u=1,t(e)})},f=function(){return o(function(e){if(!l()){for(;!e&&t.length;)t.shift()();return a(function(){return setTimeout(f)},1e5)}})},f(),i=function(e,n){var a,s,i,o,l;for(i=e.split("."),l=r.Const,s=0,o=i.length;s<o;s++)if(a=i[s],l=l[a],!l)return t.push(n);return n()},d=function(){return a(function(){return n.viewLoaded=!0})},{await:i,awaitView:function(){return CORE.pathNeedLogin()||d(),n.$on("updateViewLoaded",function(){return d()})}}}])}),define("controllers/base",["common/module","common/Const"],function(e){var n;return n={"/balance":{name:"BALANCE",nick:"余额"},"/issue":{name:"ISSUE",nick:"发行"},"/history":{name:"HISTORY",nick:"历史"},"/trade":{name:"TRADE",nick:"交易"},"/base":{name:"HISTORY",nick:"历史"}},e.controller("appCtrl",["$scope","$location","$route","$rootScope","ConstServ",function(e,t,r,a,s){var i;return e.Const=a.Const=window.Const,i=function(){var s,i,o,l,c,u;s=location.pathname||"/",l=s.split("/"),o=l.slice(0,2).join("/"),i=l.slice(0,3).join("/"),e.Page=a.Page=n[s]||n[i]||n[o]||{},e.Page.search=t.search(),e.Page.path=null!=(c=s.match(/^(\/\w+)+/))?c[0]:void 0,e.Page.params=null!=(u=r.current)?u.params:void 0},e.$on("$routeChangeSuccess",i),e.$on("$routeUpdate",i),s.awaitView()}])}),define("jade!tmpl/passport",[],function(){return'<div ng-switch="PP.action" ng-class="[PP.action]" class="Passport"><div ng-switch-when="login" class="passport"><form name="former" ng-submit="login()" class="form form2"><div class="frmCol"><p class="frm txt corename frm_icon"><input type="text" name="uname" autocomplete="uname" ng-model="formData.uname" placeholder="用户名" minlength="3" maxlength="15" required class="txt"><label title="用户名"></label><span ng-messages="former.uname.$error" role="alert"><span ng-message="minlength">至少需要3个字符</span><span ng-message="maxlength">不能多于15字符</span></span></p></div><div class="frmCol"><p class="frm txt pwd frm_icon icon_pwd"><input type="password" placeholder="密码" ng-model="formData.pwd" name="pwd_login" autocomplete="pwd_login" required class="txt"><label title="密码"></label></p></div><div ngd-hint="apiErr" ngd-hint-lv="err"></div><div class="frmCol frmColFull btns"><p class="frm"><button type="submit" ng-disabled="former.$invalid || former.$pending || pending" data-ca="passport-submit-login" ng-class="{pending: pending}" class="btn btn1 btn_next">登录</button></p></div></form></div><div ng-switch-when="signup" class="passport"><form name="former_reg" ng-submit="signup()" class="form form2"><input type="password" autocomplete="off" class="noDis"><div class="frmCol"><p class="frm txt corename"><input type="text" autocomplete="off" name="uname_reg" ng-model="formData.uname" placeholder="用户名" minlength="4" maxlength="15" required ng-pattern="/^(?=.*[a-z].*)[a-z0-9-]+$/" rd-uname ng-model-options="{debounce:400, blur: 0}" class="txt"><label title="用户名"></label><span ng-messages="former_reg.uname_reg.$error" role="alert"><span ng-message="minlength">至少需要4个字符</span><span ng-message="maxlength">不能多于15字符</span><span ng-message="pattern">只有a-z, 0-9 and hyphen (-), and must include at least one (a-z)</span><span ng-message="unameExists">用户名已存在</span></span></p></div><div class="frmCol"><p class="frm txt pwd"><input type="password" placeholder="登录密码" ng-model="formData.pwd" name="pwd" required ngd-pwd="strength" class="txt"><label title="登录密码"></label><span ng-class="{active: strength}" class="txt-msgs"><span ng-show="strength==\'match\'" class="txt-msg err">登录密码不能包含用户名</span><span ng-show="strength==\'weak\'" class="txt-msg bad">登录密码强度：简单</span><span ng-show="strength==\'medium\'" class="txt-msg bette">登录密码强度：中等</span><span ng-show="strength==\'strong\'" class="txt-msg best">登录密码强度：很好</span></span></p></div><div class="frmCol"><p class="frm txt pwd pwd2"><input type="password" placeholder="支付密码" ng-model="formData.pay_pwd" name="pay_pwd" required ngd-pwd="pay_strength" class="txt"><label title="支付密码"></label><span ng-class="{active: pay_strength}" class="txt-msgs"><span ng-show="pay_strength==\'match\'" class="txt-msg err">支付密码不能包含用户名</span><span ng-show="pay_strength==\'matchPwd\'" class="txt-msg err">支付密码不能和登录密码相同</span><span ng-show="pay_strength==\'weak\'" class="txt-msg bad">支付密码强度：简单</span><span ng-show="pay_strength==\'medium\'" class="txt-msg better">支付密码强度：中等</span><span ng-show="pay_strength==\'strong\'" class="txt-msg best">支付密码强度：很好</span></span></p></div><div class="frmCol"><p class="frm txt"><input type="email" placeholder="邮箱" ng-model="formData.email" name="email" required rd-umail ng-model-options="{debounce:400}" class="txt"><label title="邮箱"></label><span ng-messages="former_reg.email.$error" role="alert"><span ng-message="email">邮箱格式不正确</span><span ng-message="umailExists">邮箱地址已存在</span></span></p></div><div ng-if="conf.needMobi" class="frmCol frmColFull frmCol46"><p class="frm sel sel1"><select ng-model="formData.phoneCode" ng-options="country.value as \'(+\'+country.value+\') \'+country.name for country in countries"></select><label title="国家区号"></label><span class="txt-msgs active"><span class="txt-msg info">国家区号</span></span></p><p class="frm txt"><input type="text" placeholder="手机号" ng-model="formData.phoneNumber" name="phoneNumber" required ng-pattern="/[0-9]{10,}/" ng-model-options="{debounce:200}" class="txt"><label title="手机号"></label><span ng-messages="former_reg.phoneNumber.$error" role="alert"><span ng-message="pattern">手机号格式不正确</span></span></p></div><div ng-if="conf.needMobi" class="frmCol frmColFull frmCol46"><p class="frm txt"><input type="text" placeholder="手机验证码" ng-model="formData.verifyCode" name="verifyCode" required ng-pattern="/[0-9]{6}/" ng-model-options="{debounce:200}" class="txt"><label title="手机验证码"></label><span ng-messages="former_reg.verifyCode.$error" role="alert"><span ng-message="pattern">手机验证码格式不正确</span></span></p><p class="frm btns2r"><button type="button" ng-click="sendVCode()" ng-disabled="!former_reg.phoneNumber.$valid || cd&gt;0 || vcodePending" data-ca="signup-sendvcode" ng-class="{pending: vcodePending}" class="btn btn-vcode btn_minor">发送验证码<q ng-if="cd&gt;0" ng-bind="cd" class="cd"></q></button></p></div>\n<div ngd-hint="apiErr" ngd-hint-lv="err"></div><div class="frmCol frmColFull btns"><p class="frm"><button type="submit" ng-disabled="former_reg.$invalid || former_reg.$pending" data-ca="passport-submit-signup" ng-class="{pending: pending}" class="btn btn1 btn_next">注册</button></p></div><p class="fucs2"><a href="javascript:void(0)" ngd-passport="login" data-ca="passport-login" class="fuc">登录</a></p></form></div></div>'}),define("components/pwd-strength",["common/module"],function(e){return e.directive("ngdPwd",function(){return{require:"ngModel",restrict:"A",link:function(e,n,t,r){var a,s,i,o,l,c;if(r)return s=t.ngdPwd||"strength",a=t.ngdPwdFormdata||"formData",delete e[s],i=function(e,n){var t,r,a,s,i,o,l;for(o="",t=a=0,s=n.length;a<s;t=++a){for(l=n[t],i=!0,r=0;r<e&&r+t+e<n.length;)i=i&&n.charAt(r+t)===n.charAt(r+t+e),r++;r<e&&(i=!1),i?(t+=e-1,i=!1):o+=n.charAt(t)}return o},o=function(t){r.$setValidity(s,!1),e[s]=t,n.parent().removeClass("txt-msgs-active")},l=function(t){r.$setValidity(s,!0),e[s]=t,n.parent().addClass("txt-msgs-active")},c=function(n){var t,r,c,u,d,p,f,m,g,v,h;return v=0,n?(h=""+(null!=(c=e[a])?c.uname:void 0)||(null!=(u=Const.user)?u.nick:void 0),h&&~n.toLowerCase().indexOf(h.toLowerCase())?o("match"):(t=""+(null!=(d=e[a])?d.pwd:void 0)||(null!=(p=e[a])?p.password:void 0),t&&t.toLowerCase()===n.toLowerCase()?o("matchPwd"):(r=""+(null!=(f=e[a])?f.oldpwd:void 0)||(null!=(m=e[a])?m.pwd:void 0)||(null!=(g=e[a])?g.password:void 0),r&&r.toLowerCase()===n.toLowerCase()?o("newIsOld"):n.length<6?o("weak"):(v+=4*n.length,v+=1*(i(1,n).length-n.length),v+=1*(i(2,n).length-n.length),v+=1*(i(3,n).length-n.length),v+=1*(i(4,n).length-n.length),n.match(/(.*[0-9].*[0-9].*[0-9])/)&&(v+=5),n.match(/(.*[!,@,#,$,%,&,*,?,_,~].*[!,@,#,$,%,&,*,?,_,~])/)&&(v+=5),n.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)&&(v+=10),n.match(/([a-zA-Z])/)&&n.match(/([0-9])/)&&(v+=15),n.match(/([!,@,#,$,%,&,*,?,_,~])/)&&n.match(/([0-9])/)&&(v+=15),n.match(/([!,@,#,$,%,&,*,?,_,~])/)&&n.match(/([a-zA-Z])/)&&(v+=15),(n.match(/^\w+$/)||n.match(/^\d+$/))&&(v-=10),v<0&&(v=0),v>100&&(v=100),v<34?o("weak"):(l(v>=68?"strong":"medium"),n))))):e[s]=""},r.$formatters.push(c),r.$parsers.unshift(c),t.$observe("ngdPwd",function(){return c(r.$viewValue)})}}})}),define("components/markup",["common/module"],function(e){var n;return n=function(e){return e?(e=e.replace(/(`|\*\*|__)(.*?)\1/g,function(){var e,n,t,r;switch(e=arguments,n=e[0],r=e[1],t=e[2],r){case"`":n='<span class="code">'+t+"</span>";break;case"**":n='<span class="bold">'+t+"</span>";break;case"__":n='<span class="italic">'+t+"</span>"}return n}),e=e.replace(/\[(.*?)\]\((.+?)\)/g,function(){var e,n,t,r,a,s,i;return e=arguments,r=e[0],n=e[2].split(" "),i=n[0],s=(null!=(t=n[1])?t.replace(/^['"]|['"]$/g,""):void 0)||"",a=e[1]||i.replace(/^(mailto|tel|sms):/,""),'<a class="uri" href="'+i+'"'+s+">"+a+"</a>"})):""},e.directive("ngdMarkup",["$compile","$sce",function(e,t){return{scope:{markup:"=ngdMarkup"},link:function(t,r,a){var s;return s=function(a){return e(r.addClass("Markup").html(n(a)).contents())(t)},a.ngdMarkup?t.$watch("markup",function(e){return s(e)}):s(r.html())}}}])}),define("common/Gateway",["common/core"],function(){var e=(CORE.api.trade,[{name:"USD",url:"usd",currency:"usd",accounts:[{address:"chaQfQJHfCWaCgRdx327RhZoJuaK5q87kS",needShowSpecial:1,currencies:["USD"],hotwallets:[]}],available:"All countries",fees:"0%",reviews:"",term_url:"",href_url:""},{name:"BTC",url:"btc",currency:"btc",accounts:[{address:"cfqaZrjWtdcXgZZ7zCLztBLs7jsFF5yKR6",needShowSpecial:1,currencies:["BTC"],hotwallets:[]}],available:"All countries",fees:"0%",reviews:"",term_url:"",href_url:""}]);return e});var indexOf=[].indexOf||function(e){for(var n=0,t=this.length;n<t;n++)if(n in this&&this[n]===e)return n;return-1};define("lib/coin",["common/Gateway"],function(e){var n,t,r,a,s,i,o,l;return n=.001,t=1e6,i=[],s=function(e){return!!~i.indexOf(e.toUpperCase())},r=function(e){return!e||s(e)?6:8},a=[void 0,null,""],l=[void 0,!1,"no"],o=function(e,n,s){var i,o,c,u,d,p,f,m,g,v,h,y,b,C,w,$;return d=e,~a.indexOf(d)?f=d=n.default||"":(n||(n={}),f=d,n.round&&(C=BN[n.round]),h=r(n.currency),$=!~[void 0,"precission"].indexOf(n.precision),$&&(h=n.precision),w=n.ngdAmountShort||n.short,w?(u=BN.ROUND_HALF_EVEN,c=$?h:0,o=new BN(d),i=o.toString(0,u),m=i.length,f=m<4?c?o.toString(c,u):i:m<7?o.div(1e3).toString(c||1,u)+("upper"===w?"K":"k"):o.div(t).toString(1,u)+("upper"===w?"M":"m")):(p=n.fixed,y=n.fixed,p=indexOf.call(l,y)>=0?null:"fixed",g=new BN(d),b=n.isPrice,v=indexOf.call(l,b)<0?g.toPrice(C,p):g.toFormat(h,C,p),v=v.split("."),0===h&&(v.length=1),v[1]&&(v[1]='<span class="dec">.'+v[1].replace(/(0+)$/,"<span>$1</span>")+"</span>"),f=v.join(""))),s?(s.html(f),void 0===s.attr("title")||s.attr("title-hold")?(s.attr("title",e),s.attr("title-hold",!0)):void 0):f},{Fee:n,Rate:t,isNative:s,getPrecision:r,prettyAmount:o}}),define("lib/unifyBalance",["lib/coin"],function(e){var n;return n=function(n,t){var r,a,s,i,o,l;for(r=t.userInfo,r&&(delete Const.user.inactive,angular.extend(Const.user,r)),s=[],l=t.assets,i=0,o=l.length;i<o;i++)a=l[i],s.push({name:a.currency,currency:a.currency.toUpperCase(),total:new BN(a.count).add(a.lockCount).toString(),balance:a.count,precision:e.getPrecision(a.currency||2)});return n.all.length=0,[].push.apply(n.all,s),n},{all:n}}),define("services/balance",["common/module","lib/unifyBalance"],function(e,n){var t;return t=CORE.api.trade,e.factory("balanceServ",["ajax","$rootScope","$timeout",function(e,r,a){var s,i,o,l,c,u,d,p,f,m,g;return s=Const.user.balance,d=function(){if(!s)return s=Const.user.balance={ts:null,all:[]}},d(),l=function(e){return d(),s.all.length=0,s.ts=e?null:CORE.ts()},r.$on("after-logout",function(){return l(!0)}),f=null,g=function(){if(f.req)return f.watcher(),f.req.req.command="unsubscribe"},m=null,c=function(e){return a.cancel(m),m=a(u,e||500)},p=function(){if(!f)return f={},r.$watch("Const.user.enrollId",function(e,n){return e?e&&n&&e!==n?(g(),l(!0),void a(function(){return f=null,p()})):u():(n&&g(),void l(!0))})},o=!1,i=null,u=function(){return i&&i.abort(),o=!0,i=e.get(t+"myasset").success(function(e){return o=!1,n.all(s,e),s.ts=CORE.ts(),r.$broadcast("balance-update"),c(5e3)}).error(function(e){return c(5e3)})},{empty:l,all:function(){return p(),s},getBalance:u}}])}),define("services/pp",["common/module","common/locales","services/balance"],function(e,n){var t,r,a;return t=CORE.api.trade,r=n.get(),a=location.origin+"/passport/?passport=login",e.factory("ppServ",["ajax","$location","balanceServ",function(e,n,s){var i,o;return i=function(){return n.search().c},o={headers:{"content-type":"application/json"}},{login:function(n,r){var a;return a={enrollId:n.uname,enrollSecret:n.pwd},e.post(t+"login",a,o).success(function(e){return Const.justlogin=!0,angular.merge(Const.user,e.userInfo),s.empty(),r(e)}).error(function(e){return r(null,e)})},signup:function(n,s){var i;return i={json:{username:n.uname,password:n.pwd,pay_pwd:n.pay_pwd,email:n.email},lan:r,withCredentials:!0,seed:n.seed,callback:a},(n.verifyCode||n.phoneNumber)&&(i.json.verifyCode=n.verifyCode,i.json.phoneNumber=n.phoneNumber,i.json.phoneCode=n.phoneCode),e.post(t+"user/register",CORE.j2q(i)).success(function(e){return Const.justlogin=!0,Const.user=e.userInfo,s(e)}).error(function(e){return s(null,e)})},activateEmail:function(n,s){var i;return i=CORE.j2q({email:n,lan:r,callback:a}),e.get(t+"user/send_activated_mail?"+i).success(function(e){return s(e)}).error(function(e){return s(null,e)})},recoveryGetVerifyCode:function(n,r){var a;return a=CORE.j2q({nick:n.uname}),e.post(t+"user/send_sms_verify_code?"+a).success(function(e){return r(e)}).error(function(e){return r(null,e)})},recoveryByEmail:function(n,a){var s;return s={nick:n.uname,lan:r},n.gcode&&(s.payPassword=n.gcode),e.post(t+"user/forgot_password",CORE.j2q(s)).success(function(e){return a(e)}).error(function(e){return a(null,e)})},recoveryBySms:function(n,a){var s;return s={nick:n.uname,verifyCode:n.vcode,newPassword:n.pwd,lan:r},e.post(t+"user/reset_password_phone",CORE.j2q(s)).success(function(e){return a(e)}).error(function(e){return a(null,e)})},resetByEmail:function(n,r,a){var s;return s=CORE.j2q({token:n,newPassword:r}),e.post(t+"user/reset_password_email",s).success(function(e){return a(e)}).error(function(e){return a(null,e)})},userUnlock:function(n,r,a){var s;return n=n||"",s=CORE.j2q({password:r,password_pay:n}),e.post(t+"user/unlock",s).success(function(e){return a(e)}).error(function(e){return a(null,e)})},sendSms:function(n,r,a){var s;return s=CORE.j2q({nick:n,receiveType:r}),e.post(t+"user/send_sms_verify_code?"+s).success(function(e){return a(e)}).error(function(e){return a(null,e)})},sendCloseSMSEmail:function(n){return e.get(t+"user/send_close_dynamic_password_mail?lan="+r).success(function(e){return n(e)}).error(function(e){return n(null,e)})},checkUserUnlock:function(n){return e.get(t+"user/check_unlock").success(function(e){return n(e)}).error(function(e){return n(null,e)})}}}])}),define("services/passport",["common/module","common/locales","jade!tmpl/passport","components/pwd-strength","components/markup","services/pp"],function(e,n,t){var r,a,s,i,o,l;return l=n.get(!0),r="passport",a={login:"登录",signup:"注册"},o=function(e){return a[e]||a.login},i="passportCtrl",s=["$scope","$rootScope","passportServ","$location","$route","ppServ","$timeout","$sce",function(e,n,t,r,s,i,o,l){var c,u,d,p,f,m,g;return e.conf=u={needMobi:!1},d="news.read",f=5,p=CORE.LS.get(d),f>p&&(n.hasNew=!0),n.newsShow=0,n.toggleNewsShow=function(e,t){return t?n.newsShow=0:(n.newsShow=n.newsShow?0:1,p!==f?(CORE.LS.set(d,f),delete n.hasNew):void 0)},e.PP=c=t.PP(),m=r.search(),m.passport&&(c.action=m.passport),e.formData={},e.$watch("PP.action",function(r){if(r&&a[r])return e.apiErr=!1,t.search(r),n.passportName=a[r]}),g=function(e){var a,s,i;return a=r.search(),(s=e.callback||a.callback)?CORE.redirect2(s,1):(i=!0,!i&&e.userInfo.emailNotActivated?(r.search({passport:"activate",email:e.userInfo.email}),void(n.$$phase||n.$apply())):"signup"===c.action?void t.search("login"):a.c?CORE.redirect2(a.c,1):t.inPage()?CORE.redirect2("/",1):(t.search(null),null))},e.login=function(){return e.pending=!0,i.login(e.formData,function(n,t){return e.pending=!1,t?e.apiErr=t:(c.dialog&&c.dialog.close(),g(n))})},e.signup=function(){return e.pending=!0,e.apiErr=!1,i.signup(e.formData,function(n,t){return e.pending=!1,t?e.apiErr=t:(c.dialog&&c.dialog.close(),g(n))})}}],e.factory("passportServ",["$rootScope","$location","$dialog",function(e,n,i){var l,c,u,d;return l={dialog:null,action:null},d=function(t){if(n.search(r,t),!e.$$phase)return e.$apply()},c=function(){return/^\/passport/.test(location.pathname)},e.$on("$locationChangeSuccess",function(e,t,r){var s,i;if(s=n.search().passport){if(s===l.action)return;a[s]||(s="login"),l.action=s,d(l.action)}else if(!(null!=(i=Const.user)?i.enrollId:void 0))return u()}),e.$watch("Const.user.enrollId",function(e){var t;return e?(t=n.search().passport,l.dialog&&"activate"===t?(l.dialog.close(),d(null)):c()&&!~["reset","signup"].indexOf(t)?d("login"):void 0):u()}),e.$on("after-logout",function(){return u()}),u=function(e,r){var a,u;if(a=n.search(),c()&&!a.passport)return d("login");if(Const.loginChecked){if(e){if(l.action===e)return;l.action=e}else if(l.action)return;switch(CORE.pathNeedLogin()){case 1:return CORE.redirect2Login(1);case 0:if(c())return d({passport:l.action});if(r)return CORE.redirect2Login(1);break;case-1:if(null!=(u=l.dialog)?u.show():void 0)return;return l.dialog=i.open({title:o(l.action),classname:"dialog3",template:'<div class="dialogC">'+t+"</div>",controller:s,onClose:function(){return d({passport:null})}})}}},{inPage:c,search:d,PP:function(){return l},open:u,login:function(){return u("login")},signup:function(){return u("signup")},forgot:function(){return u("forgot")},recovery:function(){return u("recovery")}}}]).controller(i,s),{controller:s,tmpl:t,ctrl:i}}),define("components/passport",["common/module","services/passport"],function(e){return e.directive("ngdPassport",["$location","$route","passportServ",function(e,n,t){return{restrict:"A",link:function(e,n,r,a){return n.on("click",function(){return t.open(r.ngdPassport,!0)})}}}])}),define("common/moment",["moment","common/locales"],function(e,n){return e.locale(n.get()),e}),define("components/dpl",["common/module","common/moment","lib/coin"],function(e,n,t){var r,a;return a=[void 0,null,""],r=angular.element,e.directive("ngdSetLang",[function(){return{scope:!0,link:function(e,n,t){var r,a;return r=locales.get(),a=t.ngdSetLang,r===a&&n.addClass("curLang").find("input").attr("checked",!0),n.on("click",function(){var e;return e=n.parent(),a===locales.get()||!e.attr("disabled")&&(e.attr("disabled",!0),locales.set(a),location.reload())})}}}]).directive("ngdAmount",function(){return{require:"?ngModel",restrict:"A",link:function(e,n,r,a){return e.$watch(r.ngdAmount,function(e){return t.prettyAmount(e,r,n)})}}}).directive("ngdFillTrader",["fastServ","$rootScope","$parse",function(e,n,t){var a;return a="focus",{restrict:"A",link:function(s,i,o,l){var c;return c=e.trader(),i.addClass("fuc4"),i.on("click",function(){var e,l;return l=r("#"+a),l.length&&l.removeAttr("id"),i.attr("id",a),e=t(o.ngdFillTrader)(s),n.$broadcast("fill-trader",e)})}}}]).directive("ngdExchagneRate",["$compile",function(e){return{scope:{pair:"=ngdExchagneRate",reverse:"@ngdExchangeRateReverse"},link:function(n,r,a){var s,i;return r.on("click",function(e){if(e.stopPropagation(),angular.element(e.target).hasClass("iF"))return s(!0)}),i="",(s=function(a,s){var o,l,c,u,d;if(l=(null!=(c=n.pair)?c.data:void 0)||n.pair)return a&&!s&&(n.reverse=!n.reverse),d={},u={},d=l.isBuyAll?{currency:l.srcCurrency,amount:l.srcCount}:{currency:l.desCurrency,amount:l.desCount},u=l.isBuyAll?{currency:l.desCurrency,amount:l.desCount}:{currency:l.srcCurrency,amount:l.srcCount},o={sellCurrency:u.currency,buyCurrency:d.currency,price:l.price||new BN(u.amount).div(d.amount).toString()},l.lCurrency=o.sellCurrency,l.lAmount=n.reverse?o.price:1,l.lAmountTxt=n.reverse?t.prettyAmount(l.lAmount,{currency:l.lCurrency}):1,l.rCurrency=o.buyCurrency,l.rAmount=n.reverse?1:new BN(1).div(o.price).toString(),l.rAmountTxt=n.reverse?1:t.prettyAmount(l.rAmount,{currency:l.rCurrency}),i=['<span class="expair">','<span class="amount">'+l.lAmountTxt+"</span>",'<span class="currency">'+l.lCurrency+"</span>",'<i class="iF" style="cursor:pointer;" ng-class="[reverse?\'iF-arrowL3\':\'iF-arrowR3\']"></i>','<span class="amount">'+l.rAmountTxt+"</span>",'<span class="currency">'+l.rCurrency+"</span>","</span>"].join(""),
r.html(e(i)(n))})(n.reverse,!0)}}}])}),define("components/base",["./passport","./dpl"],function(){}),define("jade!tmpl/balance",[],function(){return'<div class="balanceList"><div ng-repeat="coin in balanceData.all" title="{{coin.currency}}" ng-class="[coin.currency, coin.currency==Page.params.base?\'active\':\'\']" ng-switch="coin.currency" class="balance"><div class="fucs"><a ng-href="/trade/base/{{coin.currency}}" ng-if="coin.currency!=\'CNY\'" class="btn btn-small btn_ignored">购买</a></div><p ng-switch-when="CNY" class="currency">CNY</p><p ng-switch-default="ng-switch-default" ng-bind="coin.currency" class="currency"></p><p class="inf1"><span ng-title="{{coin.currency}}" ngd-amount="coin.total" precision="4" class="iCoin"></span></p><p class="inf2"><label>可用余额:  </label><em ng-title="{{coin.currency}}" ngd-amount="coin.balance" precision="4" class="iCoin"></em></p></div></div>'}),define("components/balance",["common/module","jade!tmpl/balance","services/balance"],function(e,n){return e.directive("ngdBalance",["$location","balanceServ",function(e,t){return{restrict:"E",transclude:!0,template:n,link:function(e,n,r,a){return e.balanceData=t.all()}}}])}),define("controllers/balance",["common/module","components/balance"],function(e){return e.controller("balanceCtrl",["$scope",function(e){return e.$emit("updateViewLoaded")}])}),define("jade!tmpl/issuelist",[],function(){return'<div class="Issues"><div class="ops"><div class="opt"><a ng-click="newCurrency()" class="btn btn-primary">添加货币</a></div></div><div ng-controller="issuerDetail" class="issueList"><div ng-show="IssueData.issues.length" ng-class="{pending2:IssueData.pending}" class="tbl tblC"><div class="tbl-head"><ul class="tbl-tr"><li class="tbl-th currency">货币</li><li class="tbl-th total">历史发行</li><li class="tbl-th balance">当前余额</li><li class="tbl-th action"></li></ul></div><div class="tbl-body"><ul ng-repeat="issue in IssueData.issues" class="tbl-tr"><li ng-bind="issue.id" class="tbl-td currency"></li><li ng-bind="issue.count" class="tbl-td total"></li><li ng-bind="issue.leftCount" class="tbl-td balance"></li><li class="tbl-td act"><a ng-click="release(issue)" class="btn btn_minor">增发</a><a ng-click="assign(issue)" class="btn btn_minor">派发</a></li></ul></div></div></div></div>'}),define("jade!tmpl/issue/new",[],function(){return'<div class="dialogC"><div ngd-hint="apiErr" ngd-hint-lv="err"><form name="newCurrencyForm" ng-submit="mkNew()" class="form2"><div class="frmCol"><div class="frm"><em>货币</em><input type="text" required="required" name="货币" ng-model="newCurrencyData.currency" placeholder="请输入货币" class="txt larger"/></div></div><div class="frmCol"><div class="frm"><em>数量</em><input type="number" required="required" name="数量" ng-model="newCurrencyData.amount" placeholder="请输入数量" class="txt larger"/></div></div><div class="frmCol"><div class="frm frm-btns"><button type="submit" ng-disabled="pending" ng-class="{pending: pending}" class="btn btn-primary">确认</button></div><div class="frm frm-btns"><button type="button" ng-click="$oclose()" class="btn btn_ignored">取消</button></div></div></form></div></div>'}),define("services/issue",["common/module","lib/unifyBalance"],function(e,n){var t,r;return t=CORE.api.trade,r={headers:{"content-type":"application/json"}},e.factory("issueServ",["ajax","$rootScope","$timeout",function(e,n,a){return{issues:function(n){return e.get(t+"mycurrency").success(function(e){return n(e)}).error(function(e){return n(null,e)})},release:function(n,a){var s;return s={id:n.currency,count:n.amount},e.post(t+"currency/release",s,r).success(function(e){return a(e)}).error(function(e){return a(null,e)})},assignCurrency:function(n,a){return e.post(t+"currency/assign",n,r).success(function(e){return a(e)}).error(function(e){return a(null,e)})},newCurrency:function(n,a){return e.post(t+"currency/create",n,r).success(function(e){return a(e)}).error(function(e){return a(null,e)})},allUsers:function(n){return e.get(t+"users").success(function(e){return n(e)}).error(function(e){return n(null,e)})}}}])}),define("components/issuelist",["common/module","jade!tmpl/issuelist","jade!tmpl/issue/new","services/issue"],function(e,n,t){var r;return r={issues:[]},e.directive("ngdIssueList",["$location","issueServ","$timeout","$dialog",function(e,a,s,i){return{restrict:"E",transclude:!0,template:n,link:function(e,n,o,l){var c,u,d,p;return e.IssueData=r,u=null,d=function(e){return r.pending=!0,a.issues(function(n,t){var a;return r.pending=!1,t?CORE.msg(t.error_msg,"warn"):(null!=(a=n.currencys)&&a.map(function(e){return e.color="#fce0ca"}),r.issues=e?r.issues.concat(n.currencys):n.currencys)})},d(),p=null,c=function(e){return s.cancel(p),p=s(d,e||1e3)},e.newCurrency=function(){return u=i.open({title:"发行货币",classname:"dialog3",template:t,scope:e,controller:["$scope",function(n){return n.newCurrencyData={},n.mkNew=function(){var t;return t={id:n.newCurrencyData.currency,count:n.newCurrencyData.amount},e.pending=!0,a.newCurrency(t,function(n,t){return e.pending=!1,t?CORE.msg(t.error_msg,"warn"):(u.close(),c())})}}]})},e.$on("issueUpdateSuccuess",function(){return c()})}}}])}),define("controllers/issue",["common/module","components/issuelist"],function(e){return e.controller("issueCtrl",["$scope",function(e){return e.$emit("updateViewLoaded",!0)}])}),define("jade!tmpl/issue/release",[],function(){return'<div class="dialogC"><div ngd-hint="apiErr" ngd-hint-lv="err"><form name="releaseForm" ng-submit="mkRelease()" class="form2"><div class="frmCol"><div class="frm"><em>货币</em><input type="text" required="required" readonly="readonly" name="货币" ng-model="releaseData.currency" placeholder="请输入货币" class="txt larger"/></div></div><div class="frmCol"><div class="frm"><em>数量</em><input type="number" required="required" name="数量" ng-model="releaseData.amount" placeholder="请输入数量" class="txt larger"/></div></div><div class="frmCol"><div class="frm frm-btns"><button type="submit" ng-disabled="pending" ng-class="{pending: pending}" class="btn btn-primary">确认</button></div><div class="frm frm-btns"><button type="button" ng-click="$oclose()" class="btn btn_ignored">取消</button></div></div></form></div></div>'}),define("jade!tmpl/issue/assign",[],function(){return'<div class="dialogC"><div ngd-hint="apiErr" ngd-hint-lv="err"><form name="assignForm" ng-submit="mkAssign()" class="form2"><div class="frmCol"><div class="frm"><em>收件人</em></div><br/><div style="border-left: 0" class="frm sel"><select ng-model="assignData.curAssign.owner" ng-options="user for user in users" class="sel large"></select></div></div><div class="frmCol"><div class="frm"><em>数量</em><input type="number" required="required" name="数量" ng-model="assignData.curAssign.count" placeholder="请输入数量" class="txt large"/></div></div><div class="frmCol"><div class="frm frm-btns"><button type="submit" ng-disabled="pending" ng-class="{pending: pending}" class="btn btn-primary">确认</button></div><div class="frm frm-btns"><button type="button" ng-click="$oclose()" class="btn btn_ignored">取消</button></div></div></form></div></div>'}),define("controllers/issue_detail",["common/module","jade!tmpl/issue/release","jade!tmpl/issue/assign","services/issue"],function(e,n,t){var r,a;return a=["user_type1_0","user_type1_1","user_type1_2","user_type1_3","user_type1_4"],r={release:{name:"发行",title:"发行货币"},assign:{name:"派发",title:"派发货币"}},e.controller("issuerDetail",["$scope","issueServ","$dialog",function(e,a,s){var i,o,l;return i=null,o=null,l=function(e,n,t){},e.release=function(t,o){var l;if(t.id)return l=r.release,i=s.open({title:l.title,classname:"dialog3",template:n,scope:e,controller:["$scope",function(n){return n.releaseData={currency:t.id},n.mkRelease=function(){return n.pending=!0,a.release(n.releaseData,function(t,r){return n.pending=!1,r?CORE.msg(r.error_msg,"warn"):(i.close(),CORE.msg("系统正在增发{0}{1}, 请稍后查看数量更新.".format(n.releaseData.currency,n.releaseData.amount),"ok"),e.$emit("issueUpdateSuccuess"))})}}]})},e.assign=function(n,o){var l;if(n.id)return l=r.assign,i=s.open({title:l.title,classname:"dialog3",template:t,scope:e,controller:["$scope",function(t){var r;return r=function(){return t.user_pending=!0,a.allUsers(function(e,n){return t.user_pending=!0,t.users=e.users,t.assignData={curAssign:{owner:t.users[0]}}})},r(),t.mkAssign=function(){var r;return r={currency:n.id,assigns:[t.assignData.curAssign]},t.pending=!0,a.assignCurrency(r,function(r,a){return t.pending=!1,a?CORE.msg(a.error_msg,"warn"):(i.close(),CORE.msg("系统正在向{2} 派发{0}{1}, 请稍后查看数量更新.".format(t.assignData.curAssign.count,n.id,t.assignData.curAssign.owner),"ok"),e.$emit("issueUpdateSuccuess"))})}}]})},e.$emit("updateViewLoaded")}])}),define("jade!tmpl/pairSwitcher",[],function(){return'<span ng-show="type==\'base\'||type==\'both\'" ng-class="[size]" class="sel"><select ng-show="baseCurrencies.length" ng-model="baseSelected" ng-change="switch(baseSelected, \'base\')" ng-options="base.currency as base.currency for base in baseCurrencies | filter: baseFilter" sign="{{base.name}}"></select></span><span>/</span><span ng-show="type==\'trade\'||type==\'both\'" ng-class="[size]" class="sel"><select ng-show="tradeCurrencies.length" ng-model="tradeSelected" ng-change="switch(tradeSelected, \'trade\')" ng-options="trade.currency as trade.currency for trade in tradeCurrencies | filter: tradeFilter" sign="{{trade.name}}"></select></span><span ng-if="type==\'pair\'" ng-class="[size]" class="sel selA"><select ng-if="pairCurrencies.length" ng-init="pairSelected=pairSelected || pairCurrencies[0]" ng-model="pairSelected" ng-change="switchPair(pairSelected)" ng-options="pair for pair in pairCurrencies" sign="{{pair}}"></select></span>'}),define("lib/hyper2rp",["lib/coin"],function(e){var n,t,r;return n=[{id:"CNY",creator:"system"},{id:"USD",creator:"system"}],t=function(n){return{name:n.id,url:n.id.toUpperCase(),currency:n.id.toUpperCase(),precision:e.getPrecision(n.precision),total:new BN(n.count).add(n.lockCount).toString()||0,balance:n.count||0,issuer:n.creator}},r=function(e){var n,r,a,s;for(s=[],r=0,a=e.length;r<a;r++)n=e[r],s.push(t(n));return s},{gateways:r,gateway:t,default_gateways:function(){return r(n)}}}),define("services/coin",["common/module","lib/coin","lib/hyper2rp"],function(e,n,t){var r,a,s,i;return s=CORE.api.trade,a="gws.all",i=[Const.Coin.NativeF],r=t.default_gateways(),e.factory("coinServ",["ajax","$rootScope","$timeout",function(e,a,o){var l,c,u,d,p,f,m,g;return l=Const.coins||(Const.coins={ts:null,data:[],all:[],base:[],trade:[]}),g=function(e,n){var t,a;return n&&(l.data.length=0,[].push.apply(l.data,angular.copy(r))),t=[],a=[],e.map(function(e){var n;if(n=e.currency,t.push(n),!l.data.some(function(e){if(e.currency===n)return!0}))return a.push(n),l.data.push(e)}),["all","base","trade"].map(function(e){return n?(l[e].length=0,[].push.apply(l[e],t)):[].push.apply(l[e],a)})},g(r,!0),p=null,f=function(e){return o.cancel(p),p=o(m,e||500)},d=!1,u=null,m=function(){return u&&u.abort(),d=!0,u=e.get(s+"currencys").success(function(e){var n;return d=!1,n=l.data.length,g(t.gateways(e.currencys)),l.ts=CORE.ts(),a.$broadcast("coins-update"),f(3e3)}).error(function(e){return f(1e3)})},m(),c=function(e,t,r){var a,s,i,o;switch(o=e,t?(a=t.issuer,s=t.currency||t.id,i=t.issuer):(s="",i=e),r){case"issuer":case"addr":o=e;break;case"pair":o={name:s,currency:s,issuer:i,precision:n.getPrecision(s)};break;case"all":o=t}return o},{all:function(){return l.all},base:function(){return l.base},trade:function(){return l.trade},getCoins:m,getGatewayByUrl:function(e,n){var t,r,a,s;if(e){for(e=e.toUpperCase(),s=l.data,r=0,a=s.length;r<a;r++)if(t=s[r],e===t.url)return c(t.issuer,t,n);return c(e,null,n)}},getGateway:function(e,n){var t,r,a,s;if(e)for(s=l.data,r=0,a=s.length;r<a;r++)if(t=s[r],t.name===e)return c(e,t,n)},isNative:function(e){return!i.indexOf(e.toUpperCase())}}}])}),define("services/pair",["common/module","services/balance","services/coin"],function(e){var n,t;return t=angular.noop,n=CORE.api.trade,e.factory("pairServ",["ajax","$rootScope","$route","$location","$timeout","balanceServ","coinServ",function(e,n,t,r,a,s,i){var o,l,c,u,d,p,f,m,g,v,h,y,b,C;return u=i.base(),b=i.trade(),c=i.all(),m=function(e){return"fast."+e},o=function(e){var n,t;return n=m(e),t=CORE.LS.get(n),t?t.currency&&~c.indexOf(t.currency)?t:void CORE.LS.del(n):t},l=function(e,n){var t;return t=angular.copy(n),delete t.balance,delete t.total,CORE.LS.set(m(e),t)},v=function(e,n,t){return e.currency+"/"+n.currency},d={base:[],trade:[],pairs:[]},g=function(){var e,n,t,r,a,s,o,l,c,p,f,m,g,h,y,C,w,$,_;for(g=[],h=d.base,r=a=h.length-1;a>=0;r=a+=-1)_=h[r],t=_.currency,~u.indexOf(t)?g.push(t):d.base.splice(r,1);for(u.forEach(function(e){if(!~g.indexOf(e))return d.base.push(i.getGatewayByUrl(e,"pair"))}),g=[],y=d.trade,r=s=y.length-1;s>=0;r=s+=-1)_=y[r],t=_.currency,~b.indexOf(t)?g.push(t):d.trade.splice(r,1);for(b.forEach(function(e){if(!~g.indexOf(e))return d.trade.push(i.getGatewayByUrl(e,"pair"))}),m=[],C=d.base,o=0,l=C.length;o<l;o++)for(e=C[o],w=d.trade,p=0,c=w.length;p<c;p++)n=w[p],m.push(v(e,n));for($=d.pairs,r=f=$.length-1;f>=0;r=f+=-1)_=$[r],~m.indexOf(_)||d.pairs.splice(r,1);return m.forEach(function(e){if(!~d.pairs.indexOf(e))return d.pairs.push(e)})},g(),n.$on("coins-update",function(){return a(g)}),f=function(e){return o(e)||d[e]["base"===e?0:1]},p=n.fast||(n.fast={}),p.pair="",p.base=f("base"),p.trade=f("trade"),n.$on("$locationChangeSuccess",function(){var e;return(e=function(){var e,n,r;if(n=t.current,r=n.params,e=r.base,~u.indexOf(e)&&e!==p.base.currency&&y(e,"base"),e=r.trade,~b.indexOf(e)&&e!==p.trade.currency)return y(e,"trade")})()}),h=function(e,t){return t&&angular.merge(p[e],t),n.fast.pair=v(p.base,p.trade),l(e,p[e])},n.$watchGroup(["fast.base.currency","fast.base.issuer"],function(e,n){if(e)return h("base")}),n.$watchGroup(["fast.trade.currency","fast.trade.issuer"],function(e,n){if(e)return h("trade")}),C=function(e,n){var t,r,a,s;for(s=d.base,r=0,a=s.length;r<a;r++)if(t=s[r],n.currency===t.currency)return!1;return!0},s.all(),n.$watch("Const.user.balance.ts",function(e){var n,t,r,a,s,i,o,l,c,u,f,m;if(e){for(["base","trade"].map(function(e){return Const.user.balance.all.map(function(n){var t,r;return r=angular.copy(n),t="",d[e].some(function(e,n){if(e.currency===r.currency)return t=""+n}),t?angular.merge(d[e][t],r):d[e].push(r)})}),f=[],c=d.base,r=s=0,o=c.length;s<o;r=++s)for(n=c[r],u=d.trade,i=0,l=u.length;i<l;i++)m=u[i],t=m.currency,a=m.issuer,a===n.issuer&&t===n.currency&&angular.merge(d.base[r],m),t===p.base.currency&&a===p.base.issuer&&h("base",m),t===p.trade.currency&&a===p.trade.issuer&&h("trade",m),C(n,m)&&f.push(v(n,m));return d.pairs.length=0,[].push.apply(d.pairs,f)}}),y=function(e,n,a){var s,o,l,c,u,f,m,g,v;if(l=e.currency||e,l&&(s=p["base"===n?"trade":"base"],!i.isNative(l)||!i.isNative(s.currency))){if("string"==typeof e){for(g=d[n],u=0,f=g.length;u<f;u++)if(o=g[u],o.currency===e||o.issuer===e){p[n]=o;break}}else p[n]=e;if(!a&&(v=t.current.params[n],v&&v!==l))return c=new RegExp(n+"/[^/]+"),m=r.path().replace(c,n+"/"+l),r.pushState(m)}},{fast:p,allCoins:function(){return c},tradeCoins:function(){return b},baseCoins:function(){return u},base:function(){return d.base},trade:function(){return d.trade},pairs:function(){return d.pairs},all:function(){return d},getSelected:f,switch:y}}])}),define("components/pairSwitcher",["common/module","jade!tmpl/pairSwitcher","services/coin","services/pair"],function(e,n){var t;return t=["CNY","USD"],e.directive("ngdPairSwitcher",["pairServ","$rootScope","$timeout","coinServ",function(e,t,r,a){return{scope:{type:"@ngdPairSwitcher",sel:"=ngdPairSwitcherSource",cat:"@ngdPairSwitcherCat"},restrict:"A",transclude:!0,template:n,link:function(n,r,a,s){var i;return n.size=a.size,n.fast=i=t.fast,n.baseCurrencies=e.base(),n.tradeCurrencies=e.trade(),n.pairCurrencies=e.pairs(),n.baseSelected=i.base.currency,n.tradeSelected=i.trade.currency,n.pairSelected=n.pairCurrencies[0],n.baseFilter=function(e){return n.tradeSelected!==e.currency},n.tradeFilter=function(e){return n.baseSelected!==e.currency},n.$watch("baseSelected",function(){}),n.$watch("tradeSelected",function(){}),n.switch=e.switch,t.$watch("fast.pair",function(e){if(e&&n.pairSelected!==e)return n.pairSelected=e}),n.switchPair=function(n){var t;if(t=n.split("/"),e.switch(t[0],"base"),t[1])return e.switch(t[1],"trade")}}}}])}),define("jade!tmpl/myOrders",[],function(){return'<h4><strong>我的订单</strong><span class="queue"><i ng-show="myOrders.awaits.length" ng-repeat="await in myOrders.awaits" class="iF iF-thunder"></i></span><span class="opts"><span class="tabs6"><a href="javascript:void(0)" ng-click="chgType(\'held\')" ng-class="{on:type==\'held\'}" data-ca="myorder-tab-online" class="tab6">进行中<q ng-bind="myOrders.held.length" ng-show="myOrders.held.length" class="num"></q></a><a href="javascript:void(0)" ng-click="chgType(\'dealt\')" ng-class="{on:type==\'dealt\'}" data-ca="myorder-tab-history" class="tab6">最近成交<q ng-show="type!=\'dealt\'&amp;&amp;myOrders.dealtNew" ng-bind="myOrders.dealtNew" class="num"></q></a></span></span></h4><div ng-show="type==\'held\'" class="myorders offer-held"><div class="tbl tblB"><ul class="tbl-head"><li class="tbl-tr"><div ng-click="mySortBy(\'type\')" class="tbl-th tbl-sortable type">类型<i ng-show="_sortBy === \'type\'" ng-class="{reverse: _sortReverse}" class="iF iF-sort"></i></div><div class="tbl-th pair">币种</div><div ng-click="mySortBy(\'_price\')" class="tbl-th price tbl-sortable">价格<i ng-show="_sortBy === \'_price\'" ng-class="{reverse: _sortReverse}" class="iF iF-sort"></i></div><div ng-click="mySortBy(\'_amount\')" class="tbl-th tbl-sortable amount">数量<i ng-show="_sortBy === \'_amount\'" ng-class="{reverse: _sortReverse}" class="iF iF-sort"></i></div><div class="tbl-th oper">操作</div></li></ul></div><div class="content"><div ng-show="myOrders.held&amp;&amp;!myOrders.held.length" class="noCnt"><p>你没有提交任何订单.</p></div><div ng-show="myOrders.held.length" class="tbl tblB"><ol empty="{{fast.pair}}" class="tbl-body"><li ng-repeat="order in myOrders.held | filter: !show_all&amp;&amp;myOrderCurrency || \'\' | orderBy:\'-\'+_sortBy:_sortReverse" ng-hide="order.isZero" ng-class="{pending: order.pending, noDis: order.cancelled}" ng-disabled="order.pending" ng-switch="order.isBuyAll" class="tbl-tr type"><div class="tbl-td type"><span ng-show="order.isBuyAll" class="buy">买入</span><span ng-show="!order.isBuyAll" class="sell">卖出</span></div><div ng-switch-when="true" class="tbl-td pair"><span ng-bind="order.desCurrency"></span></div><div ng-switch-when="false" class="tbl-td pair"><span ng-bind="order.srcCurrency"></span></div><div class="tbl-td price"><span ngd-amount="order._price" currency="{{order._priceCurrency}}" class="value"></span></div><div class="tbl-td amount"><span ngd-amount="order._amount" class="value"></span><span ng-bind="order._amountCurrency" ng-if="show_all" class="currency"></span></div><div class="tbl-td oper"><button type="button" ng-click="cancel_order(order)" ng-disabled="order.pending" title="取消">取消</button></div></li></ol></div></div></div><div ng-if="type==\'dealt\'" class="myorders offer-dealt"><div class="tbl tblB"><ul class="tbl-head"><li class="tbl-tr"><div class="tbl-th type">类型</div><div class="tbl-th date">时间</div><div class="tbl-th action">描述</div></li></ul></div><div class="content"><div ng-show="myOrders.dealt&amp;&amp;!myOrders.dealt.length" class="noCnt"><p>您最近的成交记录为空，如需查看更多请前往<a href="/history">交易历史</a></p></div><div ng-show="myOrders.dealt.length" class="tbl tblB"><ol empty="数据载入中" class="tbl-body"><li ng-repeat="order in myOrders.dealt" ng-hide="order.isZero" class="tbl-tr type"><div class="tbl-td type"><span ng-show="order.isBuyAll" class="buy">买入</span><span ng-show="!order.isBuyAll" class="sell">卖出</span></div><div ng-bind="order.finishedDate" class="tbl-td date"></div><div class="tbl-td action"><span ng-if="order.isBuyAll">你创建了买入{{order.desCount}}{{order.desCurrency}}, 至多卖出{{order.srcCount}}{{order.srcCurrency}}的订单.</span><span ng-if="!order.isBuyAll">你创建了卖出{{order.srcCount}}{{order.srcCurrency}}至少买入{{order.desCount}}{{order.desCurrency}}的订单.</span> 价格:<span ngd-exchagne-rate="order"></span>. </div></li></ol></div></div></div>'}),define("worker/keeper",[],function(){var e=CORE.jspath+"worker/",n={},t={},r=function(r){var a=n[r];return a||(a=n[r]=new Worker(e+r+".js"),a.addEventListener("message",function(e){var n=e.data,r=t[n.id];r&&(r(n.data),delete t[n.id])})),a},a=function(e){this.worker=r(e),this.req=function(e){var n=CORE.tsid(e.type+"-");t[n]=e.cb,this.worker.postMessage({type:e.type,data:e.data,id:n})}};return function(e){return new a(e)}}),define("lib/unifyTrade",["lib/BN"],function(e){var n={};return n.txSuccess=function(e){var n=e.meta,t=e.transaction;if(n&&t&&"tesSUCCESS"==n.TransactionResult)return~["Payment","OfferCreate","OfferCancel"].indexOf(t.TransactionType)},n.mergeOffers=function(n,t){["asks","bids"].forEach(function(r){var a=n[r],s=t[r.substring(0,r.length-1)],i=function(){if(!a.length)return[].push.apply(a,s)};if(!i()){for(var o="count",l=0;l<a.length;l++){var c=a[l],u=new e(c.showPrice),d=null;if(s.some(function(e,n){if(0===u.cmp(e.showPrice))return d=s.splice(n,1)[0]}),d){var p=new e(d[o]).cmp(c[o]);angular.merge(c,d),p>0?(c.act="up",c.time=CORE.ts()):p<0?(c.act="down",c.time=CORE.ts()):c.act&&c.time&&CORE.ts()-c.time>6e4&&(c.act="",c.time=0)}else a.splice(l--,1)}i()||s.length&&s.map(function(n){var t=new e(n.showPrice),s=a.length-1;a.some(function(e,i){var o=t.cmp(e.showPrice);return"bids"==r&&o>0||"asks"==r&&o<0?a.splice(i,0,n):i==s?a.push(n):void 0})})}})},n}),define("services/fast",["common/module","common/moment","worker/keeper","lib/unifyTrade","services/pair"],function(e,n,t,r){var a,s,i,o,l;return l=t("tx"),o=200,i=angular.noop,s=function(e,t){var r;return r=n.utc("2000-01-01T00:00:00-08:00").add(1e3*e),t?r.format(t):r},a={held:{code:0},deal:{code:1},expire:{code:2},canceled:{code:3}},e.factory("fastServ",["ajax","$timeout","$rootScope","pairServ","ConstServ",function(e,t,s,o,c){var u,d,p,f,m,g,v,h,y,b,C,w,$,_,k,x,O,S,E,R,N,T,j,D,A;return C=o.fast,f=CORE.api.trade,m=CORE.api.ws,g=CORE.api.charts,E={headers:{"content-type":"application/json"}},S=function(){var e;return e={pair:C.pair,markets:{ts:null,close:null,volume:null,topn:[],max:40,high:null,low:null,latest:null},myOrders:{heldTS:null,held:null,dealt:null,dealtNew:0,awaits:[]},book:{watcher:null,unclosed:[],offer:{depth:6,ts:null,bids:[],asks:[],index:{latest:0,current:0}}}}},h=S(),s.$watch("fast.pair",function(e){var n;if(e){if(!h.pair)return h.pair=e;if(!angular.equals(e,h.pair))return h.pair=e,n=h.book.offer,n.ts&&(n.bids.length=0,n.asks.length=0,n.index.latest=0,n.index.current=0,$()),s.$$phase?void 0:s.$apply}}),s.$watch("Const.user.enrollId",function(e,n){if((!e&&n||e&&n&&e!==n)&&(h.myOrders.held=null,k(),h.myOrders.dealt))return h.myOrders.dealt=null,h.myOrders.dealtNew=0,h.myOrders.awaits.length=0,_()}),N=function(e){var n;if(n=h.myOrders.awaits.indexOf(e),~n)return h.myOrders.awaits.splice(n,1)},T=null,w=function(e){return t.cancel(T),T=t($,e||5e3)},u=null,v=!1,$=function(n,t){var a,s;if(!v||h.book.offer.ts)return v=!0,t||(t=i),u&&h.book.offer.ts&&u.abort(),s=CORE.j2r([C.base.currency,C.trade.currency,n||20]),a=h.book.offer,a.index.current=0,u=e.get(f+"tx/market/"+s).success(function(e){return r.mergeOffers(h.book.offer,e),a.ts=CORE.ts(),w(3e3),t(e)}).error(function(e){return t(null,e),v&&!a.ts&&(v=!1),w(1e3)})},D=null,O=!1,k=function(){var n,r;if(!O)return O=!0,t.cancel(D),n=a.held,r=100,e.get(f+"tx/my/"+n.code+"/"+r+"/").success(function(e){return l.req({type:"offers_held",data:e.orders,cb:function(e){return h.myOrders.held=e,h.myOrders.heldTS=CORE.ts()}})}).finally(function(){return O=!1,t.cancel(D),D=t(k,3e3)})},j=null,b=!1,_=function(){var n,r;if(!b)return b=!0,t.cancel(j),n=a.deal,r=100,e.get(f+"tx/my/"+n.code+"/"+r+"/").success(function(e){return l.req({type:"offers_dealt",data:e.orders,cb:function(e){return h.myOrders.dealt=e}})}).finally(function(){return b=!1,t.cancel(j),j=t(_,3e3)})},A=function(e,n){var t;return t=h.markets,n&&(t.topn.length=0),[].unshift.apply(t.topn,e.txs),t.topn.length>t.max&&(t.topn.length=t.max),t.open=e.o,t.high=e.h,t.low=e.l,t.close=e.c,t.volume=e.v,t.latest=t.topn[0],t.ts=CORE.ts()},d=null,p=!1,x=function(t){var r,a;if(!p||h.markets.latest)return d&&d.abort(),p=!0,r=h.markets,a={base:C.base,counter:C.trade,limit:t||r.max,reduce:!1,descending:!0,endTime:n().toISOString(),startTime:n().subtract(3,"d").toISOString()},d=e.post(g+"offersExercised",a,E).success(function(e){return A(e,!0)}).finally(function(){return p=!1})},R=function(n,t,r,a){var s;return n=Number(n),t=Number(t),s={isBuyAll:"buy"===r},"buy"===r?(s.srcCurrency=C.trade.currency,s.srcCount=t,s.desCurrency=C.base.currency,s.desCount=n):(s.srcCurrency=C.base.currency,s.srcCount=n,s.desCurrency=C.trade.currency,s.desCount=t),e.post(f+"tx/exchange",s,E).success(function(e){return a(e),k()}).error(function(e){return a(null,e)})},y=function(n,t){var r;return r={uuid:n},e.post(f+"tx/cancel",r,E).success(function(e){return t(e)}).error(function(e){return t(null,e)})},{markets:{topn:function(e){var n;return(null!=(n=h.markets.topn)?n.length:void 0)||x(),h.markets}},myOrders:function(e){switch(e){case"held":h.myOrders[e]||k();break;case"dealt":h.myOrders[e]||_()}return h.myOrders},book:function(e,n){return h.book.offer.ts||$(),h.book},trader:function(){return h.trader},makeOffer:R,cancelOffer:y}}])}),define("components/myOrders",["common/module","jade!tmpl/myOrders","services/fast","services/coin"],function(e,n){return e.directive("ngdMyOrders",["fastServ","$rootScope","coinServ",function(e,t,r){return{scope:{showType:"@ngdMyOrdersType"},restrict:"A",transclude:!0,template:n,link:function(n,a,s,i){var o;return n.fast=o=t.fast,n.type=n.showType?n.showType:"held",n.show_all=!0,n.currentSel={pair:o.pair},n.bn_div=function(e,n,t){return new BN(e).div(n).toString()},n.changeFilterShow=function(e){return n.show_all=!n.show_all},n.cancel_order=function(n){return n.pending=!0,e.cancelOffer(n.uuid,function(e,t){return n.pending=!1,t?CORE.msg(t.error_msg,"warn"):n.cancelled=!0})},n.chgType=function(e){if(n.type=e,"dealt"===e)return n.myOrders.dealtNew=0},n.$watch("type",function(t){if(t)return n.myOrders=e.myOrders(t)}),n._sortBy="_price",n._sortReverse=!0,n.mySortBy=function(e){return n._sortReverse=n._sortBy===e&&!n._sortReverse,n._sortBy=e},n.myOrderCurrency={},n.$watch("fast.pair",function(e,t){if(n.myOrderCurrency._amountCurrency!==o.base.currency&&(n.myOrderCurrency._amountCurrency=o.base.currency),n.myOrderCurrency._priceCurrency!==o.trade.currency)return n.myOrderCurrency._priceCurrency=o.trade.currency}),n.$watch("currentSel.pair",function(e){var t,a,s;if(e&&(t=e.split("/"),t.length))return n.myOrderCurrency._amountCurrency=t[0],n.myOrderCurrency._priceCurrency=null!=(a=t[1].split("."))?a[0]:void 0,n.myOrderCurrency._priceIssuer=null!=(s=r.getGateway(t[1].split(".")[0],"pair"))?s.issuer:void 0})}}}])}),define("jade!tmpl/trader2",[],function(){return'<p class="tabs2 smaller"><a href="javascript:void(0)" ng-class="{on:traderType==\'limit\'}" ng-click="chgType(\'limit\')" class="tab2">限价</a></p><div class="content"><div ng-switch="traderType" class="buysell"><form name="form_buy" novalidate ng-submit="make(\'buy\')" class="form3 dark"><div class="frmCol frmColFull avaliable"><div class="frm"><em>可用余额<i ngd-tooltip="可用余额 = 可用余额 = 实际数额 - 进行中的订单总额 - 您输入的数额" class="iF iF-question"></i></em><div class="cnt"><i title="{{fast.trade.currency}}" class="iCoin withText"><span ngd-amount="balance.trade.rest" ng-class="[balance.trade.overflow?\'em2\':\'em\']" ngd-fill-trader="[\'buy\', null, balance.trade.available, traderType]"></span></i></div></div></div><div ng-switch-when="limit" class="frmCol frmColFull"><p class="frm txt"><input type="number" required ngd-number-step min="{{::Min}}" ng-model="buy.price" placeholder="买入价 ({{fast.trade.currency}})" ng-change="check(\'buy\', \'price\')" ng-disabled="buy.pending" name="price_buy" class="txt"><label title="买入价 ({{fast.trade.currency}})"></label><span ng-messages="form_buy.price_buy.$error" role="alert"><span ng-message="min">价格不能小于{{::Min}}</span></span></p></div><div ng-switch-when="limit" class="frmCol frmColFull"><p class="frm txt"><input type="number" required ngd-number-step min="{{::Min}}" max="{{balance.trade.max}}" ng-model="buy.amount" placeholder="买入量" ng-change="check(\'buy\', \'amount\')" ng-disabled="buy.pending" name="amount_buy" class="txt"><label title="买入量"></label><span ng-messages="form_buy.amount_buy.$error" role="alert"><span ng-message="min">买入量不能小于{{::Min}}</span><span ng-message="max">最大买入量<span ngd-fill-trader="[\'buy\', null, balance.trade.max]">{{balance.trade.max}}</span></span></span></p></div><div ng-switch-when="market" class="frmCol frmColFull"><p class="frm txt"><input type="number" required ngd-number-step min="{{::Min}}" max="{{balance.trade.available}}" ng-model="buy.total" placeholder="交易额" ng-change="check(\'buy\', \'total\')" ng-disabled="buy.pending" name="total_buy" class="txt"><label title="交易额"></label><span ng-messages="form_buy.total_buy.$error" role="alert"><span ng-message="min">价格不能小于{{::Min}}</span><span ng-message="max">最大交易额<span ngd-fill-trader="[\'buy\', null, balance.trade.available, \'market\']">{{balance.trade.available}}</span></span></span></p></div><div class="frmCol frmColFull total"><div class="frm sum"><em>订单总额</em><div class="cnt"><i title="{{fast.trade.currency}}" ngd-amount="balance.trade.sum" class="iCoin withText"></i></div></div></div><div class="frmCol frmColFull"><p class="frm"><button type="submit" ng-class="{pending:buy.pending}" ng-disabled="form_buy.$invalid || buy.pending" class="btn buy">买入{{fast.base.currency}}</button></p></div></form><form name="form_sell" novalidate ng-submit="make(\'sell\')" class="form3 dark"><div class="frmCol frmColFull avaliable"><div class="frm"><em>可用余额<i ng-class="{warn: restricted}" ngd-tooltip="可用余额 = {{restricted?\'配额\':\'实际数额\'}} - 进行中的订单总额 - 您输入的数额" class="iF iF-question"></i></em><div ng-class="{stop: !restricted}" ngd-tooltip="可用余额 = {{restricted?\'配额\':\'实际数额\'}} - 进行中的订单总额 - 您输入的数额" class="cnt"><i title="{{fast.base.currency}}" class="iCoin withText"><span ngd-amount="balance.base.rest" ng-class="[balance.base.overflow?\'em2\':\'em\']" ngd-fill-trader="[\'sell\', null, balance.base.available, traderType]"></span></i></div></div></div><div ng-switch-when="limit" class="frmCol frmColFull"><p class="frm txt"><input type="number" required ngd-number-step min="0" ng-model="sell.price" placeholder="卖出价 ({{fast.trade.currency}})" ng-disabled="sell.pending" name="price_sell" class="txt"><label title="卖出价 ({{fast.trade.currency}})"></label><span ng-messages="form_sell.price_sell.$error" role="alert"><span ng-message="min">价格不能小于0</span></span></p></div><div ng-switch-when="limit" class="frmCol frmColFull"><p class="frm txt"><input type="number" required ngd-number-step min="{{::Min}}" max="{{balance.base.available}}" ng-model="sell.amount" placeholder="卖出量" ng-change="check(\'sell\', \'amount\')" ng-disabled="sell.pending" name="amount_sell" class="txt"><label title="卖出量"></label><span ng-messages="form_sell.amount_sell.$error" role="alert"><span ng-message="min">卖出量不能小于{{::Min}}</span><span ng-message="max">最大卖出量<span ngd-fill-trader="[\'sell\', null, balance.base.available]">{{balance.base.available}}</span></span></span></p></div><div ng-switch-when="market" class="frmCol frmColFull"><p class="frm txt"><input type="number" required ngd-number-step min="{{::Min}}" max="{{balance.base.available}}" ng-model="sell.total" placeholder="卖出量 ({{fast.base.currency}})" ng-change="check(\'sell\', \'total\')" ng-disabled="sell.pending" name="total_sell" class="txt"><label title="卖出量 ({{fast.base.currency}})"></label><span ng-messages="form_sell.total_sell.$error" role="alert"><span ng-message="min">数量不能小于{{::Min}}</span><span ng-message="max">最大卖出量<span ngd-fill-trader="[\'sell\', null, balance.base.available, \'market\']">{{balance.base.available}}</span></span></span></p></div><div class="frmCol frmColFull total"><div class="frm sum"><em>订单总额</em><div class="cnt"><i title="{{fast.trade.currency}}" ngd-amount="balance.base.sum" class="iCoin withText"></i></div></div></div><div class="frmCol frmColFull"><p class="frm"><button type="submit" ng-disabled="form_sell.$invalid || sell.pending" class="btn sell">卖出{{fast.base.currency}}</button></p></div></form></div></div>';
}),define("components/trader2",["common/module","jade!tmpl/trader2","services/fast","services/balance","services/coin"],function(e,n){return e.directive("ngdTrader2",["fastServ","$rootScope","$timeout","coinServ",function(e,t,r,a){var s;return s=1.1,{scope:{showType:"@ngdMyOrdersType",widgetType:"@"},restrict:"A",transclude:!0,template:n,link:function(n,a,s,i){var o,l,c,u,d,p,f,m,g,v,h,y;return n.exTypes=l=[{name:"限价",val:"limit"},{name:"市价",val:"market"}],n.exType=l[0].val,n.Fee=0,n.Min=1e-4,n.Const=Const,n.buy={},n.sell={},n.limit={},n.fast=c=t.fast,m=e.book().offer,f=n.myOrders=e.myOrders(),n.traderTypes=y=[{name:"限价",val:"limit"},{name:"市价",val:"market"}],n.traderType=y[0].val,n.chgType=function(e){return n.traderType=e,h("base"),h("trade")},u=function(e){return"buy"===e?"trade":"base"},p=function(e){return"base"===e?"sell":"buy"},v=function(e){var n,t,r;return t=c[e],r=o[e],t.available?r.available=t.available:(n=new BN(t.balance).sub(r.locked),r.available=n<0?0:n.toNumber(t.precision)),h(e)},n.$watch("fast.pair",function(e){return g("buy"),g("sell")}),n.balance=o={base:{locked:new BN(0),available:0,rest:0,sum:0,overflow:!1},trade:{locked:new BN(0),available:0,max:null,rest:0,sum:0,overflow:!1}},n.$watchGroup(["fast.base.balance","Const.user.restrictPrice","sell.price"],function(e){return v("base")}),n.$watch("fast.trade.balance",function(e){return v("trade")}),n.$watch("myOrders.heldTS",function(e){}),h=function(e){var t,r,a,s,l,u,f;switch(f=p(e),r=c[e],i=n[f],t=new BN(o[e].available),a=0,u=0,l=function(r,s,i){var l,c,u,d;if("sell"===i&&(l=c=!1,Const.user.offerQuota&&(u=Number(Const.user.offerQuota),d=new BN(u),c=d.cmp(t)<0),"limit"===s&&(l=Const.user.restrictPrice&&n.sell.price&&n.sell.price<Const.user.restrictPrice,c=!0),"market"===s&&(l=!0),n.restricted=l&&c,n.restricted&&(o[e].available=u,t=d)),a=t.sub(r),"limit"===s&&a.cmp(t)>0)return a=new BN(0)},n.traderType){case"limit":u=new BN(i.amount||0),s="buy"===f?u=u.mul(i.price||0):u.mul(i.price||0),l(u,n.traderType,f);break;case"market":s=u=new BN(i.total||0),"sell"===f&&(s=s.mul(d("buy"))),l(u,n.traderType,f)}return o[e].sum=s.toNumber(c.trade.precision),o[e].rest=a.toNumber(r.precision),o[e].overflow=a.cmp(0)<1,o[e]},g=function(e){return"buy"===e?(n.buy.price=n.buy.amount=n.buy.total="",n.check("buy","price")):(n.sell.price=n.sell.amount=n.sell.total="",n.check("sell","price"))},n.check=function(e,t){var r,a,s;if(r=u(e),a=h(r).overflow,i=n[e],s="buy"===e?c.base.precision:c.trade.precision,"buy"===e&&"price"===t)return o.trade.max=new BN(o.trade.available).div(i.price).toString(s)},d=function(e){var n,t;return"buy"===e?new BN(1.1).mul((null!=(n=m.asks[0])?n.showPrice:void 0)||0):new BN(.9).mul((null!=(t=m.bids[0])?t.showPrice:void 0)||0)},n.make=function(t){var r,a,s,i,o,l;switch(s=n[t],a=n.ask,i="buy"===t?c.base.precision:c.trade.precision,n.traderType){case"limit":r=s.amount,o=s.price,l=new BN(o).mul(r).toString();break;case"market":"buy"===t?(l=s.total,o=d("buy"),r=new BN(l).div(o).toString()):(r=s.total,o=d("sell"),l=o.mul(r).toString())}return s.pending=!0,e.makeOffer(r,l,t,function(e,t){var r;if(s.pending=!1,t)return r=CORE.ERR(t.error_code)||t.error_msg||t.error_code,CORE.msg(r,"warn");switch(CORE.msg("您的订单已提交.","ok"),n.traderType){case"limit":return s.price=s.amount="";case"market":return s.total=""}})},n.$on("fill-trader",function(e,t){var a,s,l,c,d,p,f,m,g,v;return v=t[0],p=t[1],s=t[2],g=t[3],d=u(v),"buy"===v&&(m=BN.ROUND_UP),g?g!==n.traderType&&(n.traderType=g):n.traderType=y[0].val,i=n[v],l="limit"===n.traderType?"amount":"total",p&&(a=new BN(p).toPrice(m).replace(/,/g,""),i.price=Number(a)),f=c=new BN(o[d].available),i.price&&"buy"===v&&(f=c.div(i.price)),new BN(s).cmp(f)>0&&(s=f),s&&(i[l]=new BN(s).toNumber(6)),r(function(){return n.check(v,"price")})})}}}])}),define("jade!tmpl/bidask",[],function(){return'<h5 ng-if="widgetType" class="ttl"><em>最新成交</em>&nbsp;&nbsp;<strong class="tx-latest"><span ngd-amount="markets.latest.price" is-price="is-price" ng-class="markets.latest.type" ngd-fill-trader="[markets.latest.type==\'bid\'&amp;&amp;\'sell\'||\'buy\', markets.latest.price]"></span></strong></h5><div class="content"><div class="tbl tblA"><ul class="tbl-head"><li class="tbl-tr"><div class="tbl-th cate"></div><div class="tbl-th">价格<q class="q"><i title="{{fast.trade.currency}}" class="iCoin"></i></q></div><div class="tbl-th size">数量</div></li></ul><ol empty="数据载入中" class="tbl-body asks"><li ng-repeat="ask in offer.asks | limitTo: askLen | orderBy:\'-\'" ng-class="[ask.act]" class="tbl-tr"><div class="tbl-td cate">卖{{askLen-$index}}</div><div class="tbl-td price2"><span ngd-amount="ask.price" round="ROUND_UP" is-price="is-price" fixed="fixed" ngd-fill-trader="[\'buy\', ask.price]"></span></div><div class="tbl-td size"><span ngd-amount="ask.count" precision="4" ngd-fill-trader="[\'buy\', ask.price, ask.count]" fixed="fixed"></span></div></li></ol><ol ng-if="!widgetType&amp;&amp;markets.latest.price" class="tbl-body newest"><li class="tbl-tr"><div class="tbl-th"><div class="ttl"><em>最新价</em>&nbsp;&nbsp;<strong class="tx-latest"><span ngd-amount="markets.latest.price" is-price="is-price" ng-class="markets.latest.type" ngd-fill-trader="[markets.latest.type==\'bid\'&amp;&amp;\'sell\'||\'buy\', markets.latest.price]"></span></strong></div></div></li></ol><ol empty="数据载入中" class="tbl-body bids"><li ng-repeat="bid in offer.bids | limitTo: bidLen" ng-class="[bid.act]" class="tbl-tr"><div class="tbl-td cate">买{{$index+1}}</div><div class="tbl-td price2"><span ngd-amount="bid.price" is-price="is-price" fixed="fixed" ngd-fill-trader="[\'sell\', bid.price]"></span></div><div class="tbl-td size"><span ngd-amount="bid.count" precision="4" ngd-fill-trader="[\'sell\', bid.price, bid.count]" fixed="fixed"></span></div></li></ol></div></div>'}),define("components/bidask",["common/module","lib/coin","jade!tmpl/bidask","services/fast"],function(e,n,t){return e.directive("ngdBidAsk",["fastServ","pairServ","$timeout",function(e,n,r){return{scope:{widgetType:"@",limit:"@",nofit:"@"},restrict:"A",transclude:!0,template:t,link:function(t,a,s,i){var o,l,c,u,d,p,f;return f=angular.element(window),t.Const=Const,t.offer=p=e.book().offer,t.types=["asks","bids"],t.fast=n.fast,t.limit||(t.limit=20),c=function(){return r(function(){var e,n,r,a;return n=t.offer.asks.length,r=t.offer.bids.length,e=n+r,n>t.limit&&r>t.limit?t.askLen=t.bidLen=t.limit:n===r?(n>t.limit&&(n=t.limit),t.askLen=t.bidLen=n):n>r?(t.bidLen=r,a=2*t.limit-r,n>a&&(n=a),t.askLen=n):r>n?(t.askLen=n,a=2*t.limit-n,r>a&&(r=a),t.bidLen=r):void 0})},u=a.find(".content")[0],l=function(){var e,n,r;return e=a.find(".tbl-head").height(),n=a.find(".fake").height(),r=u.offsetHeight-e,t.widgetType||(r-=n),t.limit=parseInt(r/n/2),c()},d=null,o=function(e){return r.cancel(d),d=r(l,e||50)},t.nofit||(o(),f.on("resize",function(){return o(200)}),t.$watch("Const.user.enrollId",function(){return o()})),t.$watchGroup(["offer.asks.length","offer.bids.length"],function(){return c()}),t.$on("$destroy",function(){return r.cancel(d),f.off("resize",o)})}}}])}),define("controllers/lite",["common/module","common/moment","components/pairSwitcher","components/myOrders","components/trader2","components/bidask","services/fast"],function(e,n){return e.controller("liteCtrl",["$scope","$route","$location","fastServ","pairServ",function(e,t,r,a,s){var i,o;return o=t.current.params,i=s.getSelected("base").currency,o.base?(e.m=n,e.$on("$destroy",function(){return CORE.title()}),e.$emit("updateViewLoaded")):(r.path("/trade/base/"+i),void r.replace())}])}),define("jade!tmpl/history",[],function(){return'<div class="History"><div class="tbl tblC"><ul class="tbl-head"><li class="tbl-tr"><div class="tbl-th date">时间</div><div class="tbl-th type">类型</div><div class="tbl-th amount">交易量</div><div class="tbl-th price">交易金额</div><div class="tbl-th remark">说明</div></li></ul><ul class="tbl-body"><li ng-repeat="entry in History.historys" class="his tbl-tr"><div ng-bind="entry.time" class="tbl-td date"></div><div ng-class="[entry._type.val]" class="tbl-td type"><span ng-class="[entry._type.icon]" class="iF"></span><span ng-bind="::entry._type.text" ng-class="[entry._type.val]"></span></div><div ng-switch="entry._type.val" class="tbl-td amount"><span ng-switch-when="issue_assign"><i class="ico pay"></i><i class="iCoin withText" ngd-amount="entry.data.count || entry.data.cont" title="{{entry.data.currency||entry.data.Currency || entry.data.id}}"></i></span><span ng-switch-when="issue_received"><i class="ico income"></i><i class="iCoin withText" ngd-amount="entry.data.count || entry.data.cont" title="{{entry.data.currency||entry.data.Currency || entry.data.id}}"></i></span><span ng-if="entry.type==\'Exchange\'"><i ng-class="{\'income\': entry.data.isBuyAll, \'pay\': !entry.data.isBuyAll}" class="ico"></i><span><span class="iCoin withText" ngd-amount="entry.taker_gets.amount" title="{{entry.taker_gets.currency}}"></span></span></span><span ng-if="[\'currency_create\', \'currency_release\'].indexOf(entry._type.val)&gt;-1"><i class="iCoin withText" ngd-amount="entry.data.count || entry.data.cont" title="{{entry.data.currency||entry.data.Currency || entry.data.id}}"></i></span></div><div class="tbl-td price"><span ng-if="entry.type==\'Exchange\'" class="iCoin withText"><span><span class="iCoin withText" ngd-amount="entry.taker_pays.amount" title="{{entry.taker_pays.currency}}"></span></span></span></div><div class="tbl-td remark"><span ng-if="entry.type==\'Exchange\'&amp;&amp;entry._status==\'cancelled\'">你取消挂单.</span><span ng-if="entry.type==\'Exchange\'&amp;&amp;entry._status==\'held\'">你新建挂单.</span><span ng-if="entry.type==\'Exchange\'&amp;&amp;entry._status==\'expire\'">您的挂单已过期.</span><span ng-show="entry.type==\'Exchange\'&amp;&amp;entry._status==\'deal\'">挂单成交.价格:<span ngd-exchagne-rate="entry"></span></span><span ng-if="entry._type.val==\'issue_assign\'">你向{{entry.data.owner}}派发了<i class="iCoin withText" ngd-amount="entry.data.count || entry.data.cont" title="{{entry.data.currency||entry.data.Currency || entry.data.id}}"></i>.</span><span ng-if="entry._type.val==\'issue_received\'">你收到派发金额<i class="iCoin withText" ngd-amount="entry.data.count || entry.data.cont" title="{{entry.data.currency||entry.data.Currency || entry.data.id}}"></i>.</span><span ng-if="entry._type.val==\'currency_create\'">你发行了<i class="iCoin withText" ngd-amount="entry.data.count || entry.data.cont" title="{{entry.data.currency||entry.data.Currency || entry.data.id}}"></i>.</span><span ng-if="entry._type.val==\'currency_release\'">你增发了<i class="iCoin withText" ngd-amount="entry.data.count || entry.data.cont" title="{{entry.data.currency||entry.data.Currency || entry.data.id}}"></i>.</span><span ng-if="unknown">未知类型交易</span></div></li></ul></div></div>'}),define("services/history",["common/module"],function(e){var n,t;return n=CORE.api.trade,t={headers:{"content-type":"application/json"}},e.factory("historyServ",["ajax","$rootScope","$timeout",function(e,t,r){var a,s,i;return a=["held","deal","expire","cancelled"],s={exchange_buy:{icon:"ico_4",val:"exchange_buy",text:"买入"},exchange_sell:{icon:"ico_4",val:"exchange_sell",text:"卖出"},exchange_cancel:{icon:"ico_5",val:"exchange_cancel",text:"取消"},currency_create:{icon:"ico_2",val:"currency_create",text:"创建货币"},currency_release:{icon:"ico_6",val:"currency_release",text:"增发"},issue_assign:{icon:"ico_3",val:"issue_assign",text:"派发"},issue_received:{icon:"ico_1",val:"issue_received",text:"收到"},unknown:{icon:"ico_8",val:"unknown",text:"未知"}},i=function(e){var n,t,r,i;r=e.historys;for(t in r){switch(i=r[t],n=null,i.type){case"Exchange":n="exchange_"+(i.data.isBuyAll?"buy":"sell"),i._status=a[i.data.status],i.taker_gets=i.data.isBuyAll?{amount:i.data.desCount,currency:i.data.desCurrency}:{amount:i.data.srcCount,currency:i.data.srcCurrency},i.taker_pays=i.data.isBuyAll?{amount:i.data.srcCount,currency:i.data.srcCurrency}:{amount:i.data.desCount,currency:i.data.desCurrency};break;case"AssignCurrency_MeTo":n="issue_assign";break;case"AssignCurrency_ToMe":n="issue_received";break;case"CreateCurrency":n="currency_create";break;case"ReleaseCurrency":n="currency_release";break;default:n="unknown"}i._type=s[n]}return e},{history:function(t){return e.get(n+"history").success(function(e){return t(i(e))}).error(function(e){return t(null,e)})}}}])}),define("components/history",["common/module","jade!tmpl/history","services/history"],function(e,n){var t;return t={historys:[]},e.directive("ngdHistory",["$location","$timeout","historyServ",function(e,r,a){return{restrict:"E",transclude:!0,replace:!0,template:n,link:function(e,n,r,s){var i;return e.History=t,i=function(e){return t.pending=!0,a.history(function(n,r){return t.pending=!1,r?CORE.msg(r.error_msg,"warn"):t.historys=e?t.historys.concat(n.historys):n.historys})},i(),e.loadmore=function(){return i(!0)}}}}])}),define("controllers/history",["common/module","components/history"],function(e){return e.controller("historyCtrl",["$scope",function(e){return e.$emit("updateViewLoaded")}])}),require(["config","angular","jade!tmpl/app/balance","jade!tmpl/app/issue","jade!tmpl/app/lite","jade!tmpl/app/history","vendor/ngRoute","vendor/ngPushState","_","controllers/base","components/base","controllers/balance","controllers/issue","controllers/issue_detail","controllers/lite","controllers/history"],function(e,n,t,r,a,s){var i;return i="hyper",n.module(i,["CORE","ngRoute","ngPushState"]).config(["$routeProvider","$locationProvider","$compileProvider",function(e,n,i){var o;return i.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|javascript|chrome-extension|bitcoin):/),n.html5Mode(!0),e.when("/",{redirectTo:"/balance"}).when("/balance",{template:t,controller:"balanceCtrl"}).when("/issue",{template:r,controller:"issueCtrl"}).when("/history",{template:s,controller:"historyCtrl"}),o={template:a,controller:"liteCtrl"},e.when("/trade",o).when("/trade/base/:base",o),e.otherwise("/")}]).controller("otherwise",["$location","$rootScope","$route",function(e,n,t){return n.$on("$routeChangeStart",function(n,t){if(!t)return n.preventDefault(),location.href=e.path()})}]),n.element().ready(function(){return n.bootstrap(document.documentElement,[i])})}),define("app/main",function(){});